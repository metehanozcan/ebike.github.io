<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EBike - Bicycle Rental Management System</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Charts.js for analytics -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f5f3ff',
              100: '#ede9fe',
              200: '#ddd6fe',
              300: '#c4b5fd',
              400: '#a78bfa',
              500: '#8b5cf6',
              600: '#7c3aed',
              700: '#6d28d9',
              800: '#5b21b6',
              900: '#4c1d95',
              950: '#2e1065',
            },
            secondary: {
              50: '#ecfdf5',
              100: '#d1fae5',
              200: '#a7f3d0',
              300: '#6ee7b7',
              400: '#34d399',
              500: '#10b981',
              600: '#059669',
              700: '#047857',
              800: '#065f46',
              900: '#064e3b',
              950: '#022c22',
            },
            accent: {
              50: '#fff7ed',
              100: '#ffedd5',
              200: '#fed7aa',
              300: '#fdba74',
              400: '#fb923c',
              500: '#f97316',
              600: '#ea580c',
              700: '#c2410c',
              800: '#9a3412',
              900: '#7c2d12',
              950: '#431407',
            },
            dark: {
              100: '#1e1e24',
              200: '#181820',
              300: '#141418',
              400: '#0d0d10',
              500: '#000000',
            }
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-in': 'slideIn 0.5s ease-in-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideIn: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
          },
        }
      }
    }
  </script>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      box-sizing: border-box;
      transition: background-color 0.3s, border-color 0.3s, color 0.3s;
    }
    
    .card {
      backdrop-filter: blur(10px);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .dark .card {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      grid-gap: 1.5rem;
    }
    
    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    
    ::-webkit-scrollbar-thumb {
      background-color: rgba(155, 155, 155, 0.5);
      border-radius: 20px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background-color: rgba(155, 155, 155, 0.8);
    }
    
    /* Dark mode scrollbar */
    .dark ::-webkit-scrollbar-thumb {
      background-color: rgba(100, 100, 100, 0.5);
    }
    
    .dark ::-webkit-scrollbar-thumb:hover {
      background-color: rgba(100, 100, 100, 0.8);
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .slide-in {
      animation: slideIn 0.5s ease-in-out;
    }
    
    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    
    @keyframes slideIn {
      0% { transform: translateY(20px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    
    /* QR code animation */
    .qr-animation {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    /* Chart animations */
    .chart-container {
      transition: all 0.5s ease;
    }
    
    /* Payment card flip animation */
    .payment-card {
      perspective: 1000px;
    }
    
    .payment-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }
    
    .payment-card.flipped .payment-card-inner {
      transform: rotateY(180deg);
    }
    
    .payment-card-front, .payment-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
    }
    
    .payment-card-back {
      transform: rotateY(180deg);
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-dark-200 text-gray-900 dark:text-gray-100 font-sans antialiased min-h-screen">
  <div id="app" class="min-h-screen"></div>
  
  <script type="text/babel">
    // Main App Component
    const { useState, useEffect, useRef, useMemo, createContext, useContext } = React;
    
    // App Context for global state
    const AppContext = createContext();
    
    // Mock data for demo purposes
 
    
    const mockBicycles = [
  { 
    id: 'B001',
    name: 'Mountain Explorer',
    type: 'Mountain',
    color: 'Red',
    status: 'available',
    maintenance: [],
    ratePerDay: 15,
    image: 'https://i.ebayimg.com/images/g/pFoAAOSwH-xm0Wzz/s-l1600.webp'
  },
  { 
    id: 'B002',
    name: 'City Cruiser',
    type: 'Cruiser',
    color: 'Blue',
    status: 'rented',
    maintenance: [],
    ratePerDay: 12,
    image: 'https://i.ebayimg.com/images/g/pFoAAOSwH-xm0Wzz/s-l1600.webp'
  },
  { 
    id: 'B003',
    name: 'Road Master',
    type: 'Road',
    color: 'Black',
    status: 'maintenance',
    maintenance: [{ date: '2023-06-15', issue: 'Flat tire', cost: 25 }],
    ratePerDay: 18,
    image: 'https://i.ebayimg.com/images/g/pFoAAOSwH-xm0Wzz/s-l1600.webp'
  },
  { 
    id: 'B004',
    name: 'Urban Commuter',
    type: 'Hybrid',
    color: 'Green',
    status: 'available',
    maintenance: [],
    ratePerDay: 14,
    image: 'https://i.ebayimg.com/images/g/pFoAAOSwH-xm0Wzz/s-l1600.webp'
  },
  { 
    id: 'B005',
    name: 'Eco Rider',
    type: 'Electric',
    color: 'White',
    status: 'available',
    maintenance: [],
    ratePerDay: 25,
    image: 'https://i.ebayimg.com/images/g/pFoAAOSwH-xm0Wzz/s-l1600.webp'
  },
];
    
    const mockUsers = [
      { id: 'U001', name: 'Hüseyin', email: 'Hüseyin@example.com', phone: '123-456-7890', address: '123 Golburn St, City', studentId: 'S12345', status: 'verified', rentals: ['B002'], avatar: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50"><circle cx="25" cy="20" r="12" fill="%23FFB6C1"/><circle cx="25" cy="55" r="25" fill="%23FFB6C1"/></svg>' },
      { id: 'U002', name: 'Mete', email: 'Mete@example.com', phone: '234-567-8901', address: '456 Pitt St, Haymarket', studentId: 'S67890', status: 'pending', rentals: [], avatar: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50"><circle cx="25" cy="20" r="12" fill="%23ADD8E6"/><circle cx="25" cy="55" r="25" fill="%23ADD8E6"/></svg>' },
      { id: 'U003', name: 'Emre', email: 'Emre@example.com', phone: '345-678-9012', address: '789 Harrist St, Haymarket', studentId: 'S54321', status: 'verified', rentals: [], avatar: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50"><circle cx="25" cy="20" r="12" fill="%2398FB98"/><circle cx="25" cy="55" r="25" fill="%2398FB98"/></svg>' },
    ];
    
    const mockPayments = [
      { id: 'P001', userId: 'U001', bicycleId: 'B002', amount: 36, date: '2023-06-01', type: 'rental', status: 'paid' },
      { id: 'P002', userId: 'U001', bicycleId: 'B002', amount: 36, date: '2023-07-01', type: 'rental', status: 'pending' },
      { id: 'P003', userId: 'U003', amount: 50, date: '2023-06-15', type: 'membership', status: 'paid' },
    ];
    
    const mockMaintenanceLogs = [
      { id: 'M001', bicycleId: 'B003', reportDate: '2023-06-15', issue: 'Flat tire', description: 'Rear tire puncture', cost: 25, status: 'completed', completedDate: '2023-06-16' },
      { id: 'M002', bicycleId: 'B002', reportDate: '2023-05-20', issue: 'Chain adjustment', description: 'Chain skipping gears', cost: 15, status: 'completed', completedDate: '2023-05-21' },
      { id: 'M003', bicycleId: 'B005', reportDate: '2023-07-05', issue: 'Battery issues', description: 'Not holding charge properly', cost: 120, status: 'pending', completedDate: null },
    ];
    
    const mockRecentActivity = [
      { id: 'A001', type: 'rental', userId: 'U001', bicycleId: 'B002', timestamp: '2023-07-12T10:30:00', message: 'Bicycle B002 assigned to Hüseyin' },
      { id: 'A002', type: 'maintenance', bicycleId: 'B003', timestamp: '2023-07-11T14:15:00', message: 'Maintenance reported for Bicycle B003' },
      { id: 'A003', type: 'payment', userId: 'U003', amount: 50, timestamp: '2023-07-11T10:45:00', message: 'Payment of $50 received from Emre' },
      { id: 'A004', type: 'user', userId: 'U002', timestamp: '2023-07-10T16:30:00', message: 'New user Mete registered' },
    ];
    
    // App Provider Component
    const AppProvider = ({ children }) => {
      const [darkMode, setDarkMode] = useState(false);
      const [activePage, setActivePage] = useState('dashboard');
      const [bicycles, setBicycles] = useState(mockBicycles);
      const [users, setUsers] = useState(mockUsers);
      const [payments, setPayments] = useState(mockPayments);
      const [maintenanceLogs, setMaintenanceLogs] = useState(mockMaintenanceLogs);
      const [recentActivity, setRecentActivity] = useState(mockRecentActivity);
      const [notifications, setNotifications] = useState([]);
      const [activeModal, setActiveModal] = useState(null);
      const [modalData, setModalData] = useState(null);
      
      // Check for dark mode preference
      useEffect(() => {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          setDarkMode(true);
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
          setDarkMode(event.matches);
        });
      }, []);
      
      // Apply dark mode to HTML element
      useEffect(() => {
        if (darkMode) {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      }, [darkMode]);
      
      // Get bicycle status counts for dashboard
      const bicycleStatusCounts = useMemo(() => {
        const counts = {
          available: 0,
          rented: 0,
          maintenance: 0
        };
        
        bicycles.forEach(bike => {
          counts[bike.status] = (counts[bike.status] || 0) + 1;
        });
        
        return counts;
      }, [bicycles]);
      
      // Calculate financial metrics
      const financialMetrics = useMemo(() => {
        const totalRevenue = payments.reduce((sum, payment) => {
          if (payment.status === 'paid') {
            return sum + payment.amount;
          }
          return sum;
        }, 0);
        
        const pendingRevenue = payments.reduce((sum, payment) => {
          if (payment.status === 'pending') {
            return sum + payment.amount;
          }
          return sum;
        }, 0);
        
        const maintenanceCosts = maintenanceLogs.reduce((sum, log) => {
          return sum + (log.cost || 0);
        }, 0);
        
        const netRevenue = totalRevenue - maintenanceCosts;
        
        return {
          totalRevenue,
          pendingRevenue,
          maintenanceCosts,
          netRevenue
        };
      }, [payments, maintenanceLogs]);
      
      // Add activity to recent activity log
      const addActivity = (activity) => {
        const newActivity = {
          id: `A${(recentActivity.length + 1).toString().padStart(3, '0')}`,
          timestamp: new Date().toISOString(),
          ...activity
        };
        
        setRecentActivity(prev => [newActivity, ...prev]);
      };
      
      const openModal = (type, data = null) => {
        setActiveModal(type);
        setModalData(data);
      };
      
      const closeModal = () => {
        setActiveModal(null);
        setModalData(null);
      };
      
      const addNotification = (message, type = 'info') => {
        const id = Date.now();
        setNotifications(prev => [...prev, { id, message, type, timestamp: new Date() }]);
        
        // Auto-remove notification after 5 seconds
        setTimeout(() => {
          setNotifications(prev => prev.filter(n => n.id !== id));
        }, 5000);
      };
      
      // Functions for managing bicycles
      const addBicycle = (bicycle) => {
        const newBicycle = {
          ...bicycle,
          id: `B${(bicycles.length + 1).toString().padStart(3, '0')}`,
          status: 'available',
          maintenance: []
        };
        
        setBicycles(prev => [...prev, newBicycle]);
        addNotification(`Bicycle ${newBicycle.name} has been added`, 'success');
        addActivity({
          type: 'bicycle',
          message: `New bicycle ${newBicycle.name} has been added to the fleet`
        });
      };
      
      const updateBicycle = (id, updates) => {
        setBicycles(prev => prev.map(bike => 
          bike.id === id ? { ...bike, ...updates } : bike
        ));
        addNotification(`Bicycle ${id} has been updated`, 'success');
        addActivity({
          type: 'bicycle',
          bicycleId: id,
          message: `Bicycle ${id} information has been updated`
        });
      };
      
      const deleteBicycle = (id) => {
        // Get the bicycle name before deletion
        const bike = bicycles.find(b => b.id === id);
        
        // First check if the bicycle is rented
        if (bike && bike.status === 'rented') {
          addNotification(`Cannot delete rented bicycle ${id}`, 'error');
          return false;
        }
        
        setBicycles(prev => prev.filter(bike => bike.id !== id));
        addNotification(`Bicycle ${id} has been removed`, 'success');
        addActivity({
          type: 'bicycle',
          bicycleId: id,
          message: `Bicycle ${bike ? bike.name : id} has been removed from the fleet`
        });
        
        return true;
      };
      
      // Functions for managing users
      const addUser = (user) => {
        const newUser = {
          ...user,
          id: `U${(users.length + 1).toString().padStart(3, '0')}`,
          status: 'pending',
          rentals: []
        };
        
        setUsers(prev => [...prev, newUser]);
        addNotification(`User ${newUser.name} has been registered`, 'success');
        addActivity({
          type: 'user',
          userId: newUser.id,
          message: `New user ${newUser.name} has been registered`
        });
      };
      
      const updateUser = (id, updates) => {
        setUsers(prev => prev.map(user => 
          user.id === id ? { ...user, ...updates } : user
        ));
        
        const user = users.find(u => u.id === id);
        addNotification(`User ${user ? user.name : id} has been updated`, 'success');
        addActivity({
          type: 'user',
          userId: id,
          message: `User ${user ? user.name : id} information has been updated`
        });
      };
      
      const verifyUser = (id) => {
        setUsers(prev => prev.map(user => 
          user.id === id ? { ...user, status: 'verified' } : user
        ));
        
        const user = users.find(u => u.id === id);
        addNotification(`User ${user ? user.name : id} has been verified`, 'success');
        addActivity({
          type: 'user',
          userId: id,
          message: `User ${user ? user.name : id} has been verified`
        });
      };
      
      const deleteUser = (id) => {
        const user = users.find(u => u.id === id);
        
        // Check if user has active rentals
        if (user && user.rentals.length > 0) {
          addNotification(`Cannot delete user with active rentals`, 'error');
          return false;
        }
        
        setUsers(prev => prev.filter(user => user.id !== id));
        addNotification(`User ${user ? user.name : id} has been removed`, 'success');
        addActivity({
          type: 'user',
          userId: id,
          message: `User ${user ? user.name : id} has been removed from the system`
        });
        
        return true;
      };
      
      // Functions for managing rentals
      const assignBicycle = (userId, bicycleId, rentalDays = 3) => {
        // Check if bicycle is available
        const bike = bicycles.find(b => b.id === bicycleId);
        if (!bike || bike.status !== 'available') {
          addNotification(`Bicycle ${bicycleId} is not available for rental`, 'error');
          return false;
        }
        
        // Check if user is verified
        const user = users.find(u => u.id === userId);
        if (!user || user.status !== 'verified') {
          addNotification(`User ${userId} is not verified for rentals`, 'error');
          return false;
        }
        
        // Update bicycle status
        setBicycles(prev => prev.map(bike => 
          bike.id === bicycleId ? { ...bike, status: 'rented' } : bike
        ));
        
        // Update user rentals
        setUsers(prev => prev.map(user => 
          user.id === userId ? { ...user, rentals: [...user.rentals, bicycleId] } : user
        ));
        
        // Calculate rental amount
        const rentalAmount = bike.ratePerDay * rentalDays;
        
        // Create payment record
        const payment = {
          id: `P${(payments.length + 1).toString().padStart(3, '0')}`,
          userId,
          bicycleId,
          amount: rentalAmount,
          date: new Date().toISOString().split('T')[0],
          type: 'rental',
          status: 'pending',
          rentalDays
        };
        
        setPayments(prev => [...prev, payment]);
        
        addNotification(`Bicycle ${bike.name} has been assigned to ${user.name}`, 'success');
        addActivity({
          type: 'rental',
          userId,
          bicycleId,
          message: `Bicycle ${bike.name} (${bicycleId}) assigned to ${user.name} for ${rentalDays} days`
        });
        
        return true;
      };
      
      const returnBicycle = (userId, bicycleId) => {
        // Verify that the bicycle is assigned to the user
        const user = users.find(u => u.id === userId);
        if (!user || !user.rentals.includes(bicycleId)) {
          addNotification(`Bicycle ${bicycleId} is not rented by user ${userId}`, 'error');
          return false;
        }
        
        // Get bicycle details
        const bike = bicycles.find(b => b.id === bicycleId);
        if (!bike) {
          addNotification(`Bicycle ${bicycleId} not found`, 'error');
          return false;
        }
        
        // Update bicycle status
        setBicycles(prev => prev.map(bike => 
          bike.id === bicycleId ? { ...bike, status: 'available' } : bike
        ));
        
        // Update user rentals
        setUsers(prev => prev.map(user => 
          user.id === userId ? { ...user, rentals: user.rentals.filter(id => id !== bicycleId) } : user
        ));
        
        addNotification(`Bicycle ${bike.name} has been returned by ${user.name}`, 'success');
        addActivity({
          type: 'return',
          userId,
          bicycleId,
          message: `Bicycle ${bike.name} (${bicycleId}) returned by ${user.name}`
        });
        
        return true;
      };
      
      // Functions for managing maintenance
      const reportMaintenance = (bicycleId, issue, description, cost = 0) => {
        // Verify bicycle exists
        const bike = bicycles.find(b => b.id === bicycleId);
        if (!bike) {
          addNotification(`Bicycle ${bicycleId} not found`, 'error');
          return false;
        }
        
        // Create maintenance log
        const maintenanceLog = {
          id: `M${(maintenanceLogs.length + 1).toString().padStart(3, '0')}`,
          bicycleId,
          reportDate: new Date().toISOString().split('T')[0],
          issue,
          description,
          cost: parseFloat(cost),
          status: 'pending',
          completedDate: null
        };
        
        setMaintenanceLogs(prev => [...prev, maintenanceLog]);
        
        // Update bicycle status if it's not already in maintenance
        if (bike.status !== 'maintenance') {
          // If the bike is rented, find the user and update their rentals
          if (bike.status === 'rented') {
            const user = users.find(user => user.rentals.includes(bicycleId));
            if (user) {
              setUsers(prev => prev.map(u => 
                u.id === user.id ? { ...u, rentals: u.rentals.filter(id => id !== bicycleId) } : u
              ));
              
              addNotification(`Bicycle ${bicycleId} has been removed from ${user.name}'s rentals due to maintenance`, 'warning');
              addActivity({
                type: 'rental_ended',
                userId: user.id,
                bicycleId,
                message: `Rental ended early for bicycle ${bike.name} due to maintenance issue`
              });
            }
          }
          
          setBicycles(prev => prev.map(bike => 
            bike.id === bicycleId ? { ...bike, status: 'maintenance' } : bike
          ));
        }
        
        // Add maintenance to the bicycle's maintenance history
        setBicycles(prev => prev.map(bike => {
          if (bike.id === bicycleId) {
            return {
              ...bike, 
              maintenance: [...bike.maintenance, {
                date: maintenanceLog.reportDate,
                issue,
                cost: parseFloat(cost)
              }]
            };
          }
          return bike;
        }));
        
        addNotification(`Maintenance reported for bicycle ${bike.name}`, 'warning');
        addActivity({
          type: 'maintenance',
          bicycleId,
          maintenanceId: maintenanceLog.id,
          message: `Maintenance reported for bicycle ${bike.name}: ${issue}`
        });
        
        return true;
      };
      
      const completeMaintenance = (maintenanceId, finalCost) => {
        // Find the maintenance log
        const log = maintenanceLogs.find(l => l.id === maintenanceId);
        if (!log) {
          addNotification(`Maintenance log ${maintenanceId} not found`, 'error');
          return false;
        }
        
        // Update maintenance log
        const updatedLogs = maintenanceLogs.map(log => {
          if (log.id === maintenanceId) {
            return {
              ...log,
              status: 'completed',
              completedDate: new Date().toISOString().split('T')[0],
              cost: parseFloat(finalCost)
            };
          }
          return log;
        });
        
        setMaintenanceLogs(updatedLogs);
        
        // Find the bicycle
        const bike = bicycles.find(b => b.id === log.bicycleId);
        if (!bike) {
          addNotification(`Bicycle ${log.bicycleId} not found`, 'error');
          return false;
        }
        
        // Check if there are any other pending maintenance logs for this bicycle
        const hasPendingMaintenance = updatedLogs.some(l => 
          l.bicycleId === log.bicycleId && l.id !== maintenanceId && l.status === 'pending'
        );
        
        // Update bicycle status if no more pending maintenance
        if (!hasPendingMaintenance) {
          setBicycles(prev => prev.map(bike => 
            bike.id === log.bicycleId ? { ...bike, status: 'available' } : bike
          ));
        }
        
        // Update maintenance cost in bicycle history
        setBicycles(prev => prev.map(bike => {
          if (bike.id === log.bicycleId) {
            return {
              ...bike,
              maintenance: bike.maintenance.map(item => {
                if (item.date === log.reportDate && item.issue === log.issue) {
                  return { ...item, cost: parseFloat(finalCost) };
                }
                return item;
              })
            };
          }
          return bike;
        }));
        
        addNotification(`Maintenance completed for ${bike.name}`, 'success');
        addActivity({
          type: 'maintenance_completed',
          bicycleId: log.bicycleId,
          maintenanceId,
          message: `Maintenance completed for bicycle ${bike.name}: ${log.issue}`
        });
        
        return true;
      };
      
      // Functions for managing payments
      const recordPayment = (userId, amount, type, bicycleId = null) => {
        // Verify the user exists
        const user = users.find(u => u.id === userId);
        if (!user) {
          addNotification(`User ${userId} not found`, 'error');
          return false;
        }
        
        // If it's a rental payment, verify the bicycle exists and is rented by the user
        if (type === 'rental' && bicycleId) {
          const bike = bicycles.find(b => b.id === bicycleId);
          if (!bike) {
            addNotification(`Bicycle ${bicycleId} not found`, 'error');
            return false;
          }
          
          if (!user.rentals.includes(bicycleId)) {
            addNotification(`Bicycle ${bicycleId} is not rented by ${user.name}`, 'error');
            return false;
          }
        }
        
        const payment = {
          id: `P${(payments.length + 1).toString().padStart(3, '0')}`,
          userId,
          bicycleId,
          amount: parseFloat(amount),
          date: new Date().toISOString().split('T')[0],
          type,
          status: 'paid'
        };
        
        setPayments(prev => [...prev, payment]);
        
        addNotification(`Payment of $${amount} received from ${user.name}`, 'success');
        addActivity({
          type: 'payment',
          userId,
          bicycleId,
          amount: parseFloat(amount),
          message: `Payment of $${amount} received from ${user.name} for ${type}`
        });
        
        return true;
      };
      
      const markPaymentAsPaid = (paymentId) => {
        // Find the payment
        const payment = payments.find(p => p.id === paymentId);
        if (!payment) {
          addNotification(`Payment ${paymentId} not found`, 'error');
          return false;
        }
        
        // Update payment status
        setPayments(prev => prev.map(payment => 
          payment.id === paymentId ? { ...payment, status: 'paid' } : payment
        ));
        
        // Find the user
        const user = users.find(u => u.id === payment.userId);
        
        addNotification(`Payment ${paymentId} marked as paid`, 'success');
        addActivity({
          type: 'payment_updated',
          userId: payment.userId,
          bicycleId: payment.bicycleId,
          amount: payment.amount,
          message: `Payment of $${payment.amount} from ${user ? user.name : payment.userId} marked as paid`
        });
        
        return true;
      };
      
      return (
        <AppContext.Provider value={{
          darkMode,
          setDarkMode,
          activePage,
          setActivePage,
          bicycles,
          users,
          payments,
          maintenanceLogs,
          recentActivity,
          notifications,
          activeModal,
          modalData,
          bicycleStatusCounts,
          financialMetrics,
          openModal,
          closeModal,
          addNotification,
          addBicycle,
          updateBicycle,
          deleteBicycle,
          addUser,
          updateUser,
          verifyUser,
          deleteUser,
          assignBicycle,
          returnBicycle,
          reportMaintenance,
          completeMaintenance,
          recordPayment,
          markPaymentAsPaid
        }}>
          {children}
        </AppContext.Provider>
      );
    };
    
    // Modal Component
    const Modal = () => {
      const { 
        activeModal, 
        modalData, 
        closeModal, 
        addBicycle, 
        updateBicycle,
        addUser, 
        updateUser,
        verifyUser,
        reportMaintenance, 
        completeMaintenance,
        recordPayment, 
        assignBicycle,
        returnBicycle,
        users, 
        bicycles 
      } = useContext(AppContext);
      
      const [formData, setFormData] = useState({});
      const modalRef = useRef(null);
      
      useEffect(() => {
        if (modalData) {
          setFormData(modalData);
        } else {
          setFormData({});
        }
      }, [modalData]);
      
      const handleInputChange = (e) => {
        const { name, value, type, checked } = e.target;
        setFormData({
          ...formData,
          [name]: type === 'checkbox' ? checked : value
        });
      };
      
      const handleFileChange = (e) => {
        const { name, files } = e.target;
        if (files && files[0]) {
          // In a real app, we would handle file upload
          // Here we'll simulate by just setting a placeholder
          setFormData({
            ...formData,
            [name]: 'file_uploaded.jpg'
          });
        }
      };
      
      const handleSubmit = (e) => {
        e.preventDefault();
        
        switch (activeModal) {
          case 'addBicycle':
            addBicycle(formData);
            break;
          case 'editBicycle':
            updateBicycle(formData.id, formData);
            break;
          case 'addUser':
            addUser(formData);
            break;
          case 'editUser':
            updateUser(formData.id, formData);
            break;
          case 'verifyUser':
            verifyUser(formData.id);
            break;
          case 'reportMaintenance':
            reportMaintenance(formData.bicycleId, formData.issue, formData.description, parseFloat(formData.cost || 0));
            break;
          case 'completeMaintenance':
            completeMaintenance(formData.id, parseFloat(formData.cost || 0));
            break;
          case 'makePayment':
            recordPayment(formData.userId, parseFloat(formData.amount), formData.type, formData.bicycleId);
            break;
          case 'assignBicycle':
            assignBicycle(formData.userId, formData.bicycleId, parseInt(formData.rentalDays || 3));
            break;
          case 'returnBicycle':
            returnBicycle(formData.userId, formData.bicycleId);
            break;
          default:
            break;
        }
        
        closeModal();
      };
      
      // If no active modal, return null
      if (!activeModal) return null;
      
      // Modal titles
      const modalTitles = {
        addBicycle: 'Add New Bicycle',
        editBicycle: 'Edit Bicycle',
        addUser: 'Register New User',
        editUser: 'Edit User Profile',
        verifyUser: 'Verify User',
        reportMaintenance: 'Report Maintenance Issue',
        completeMaintenance: 'Complete Maintenance',
        makePayment: 'Record Payment',
        bicycleDetails: 'Bicycle Details',
        userDetails: 'User Profile',
        assignBicycle: 'Assign Bicycle to User',
        returnBicycle: 'Return Bicycle'
      };
      
      // Click outside to close
      const handleClickOutside = (e) => {
        if (modalRef.current && !modalRef.current.contains(e.target)) {
          closeModal();
        }
      };
      
      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 animate-fade-in" onClick={handleClickOutside}>
          <div ref={modalRef} className="bg-white dark:bg-dark-100 rounded-lg shadow-xl max-w-md w-full mx-4 animate-slide-in overflow-hidden" onClick={e => e.stopPropagation()}>
            <div className="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
              <h2 className="text-xl font-semibold">{modalTitles[activeModal]}</h2>
              <button onClick={closeModal} className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                <i className="fas fa-times"></i>
              </button>
            </div>
            
            <div className="p-4 max-h-[80vh] overflow-y-auto">
              {/* Add Bicycle Form */}
              {activeModal === 'addBicycle' && (
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Name</label>
                    <input
                      type="text"
                      name="name"
                      value={formData.name || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Type</label>
                    <select
                      name="type"
                      value={formData.type || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    >
                      <option value="">Select Type</option>
                      <option value="Mountain">Mountain</option>
                      <option value="Road">Road</option>
                      <option value="Hybrid">Hybrid</option>
                      <option value="Cruiser">Cruiser</option>
                      <option value="Electric">Electric</option>
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Color</label>
                    <input
                      type="text"
                      name="color"
                      value={formData.color || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Daily Rate ($)</label>
                    <input
                      type="number"
                      name="ratePerDay"
                      value={formData.ratePerDay || ''}
                      onChange={handleInputChange}
                      min="1"
                      step="0.01"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Bicycle Image</label>
                    <input
                      type="file"
                      name="image"
                      onChange={handleFileChange}
                      accept="image/*"
                      className="mt-1 block w-full text-sm text-gray-500 dark:text-gray-400
                      file:mr-4 file:py-2 file:px-4
                      file:rounded-md file:border-0
                      file:text-sm file:font-semibold
                      file:bg-primary-50 file:text-primary-700
                      dark:file:bg-primary-900 dark:file:text-primary-200
                      hover:file:bg-primary-100 dark:hover:file:bg-primary-800"
                    />
                    <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
                      Upload a clear image of the bicycle
                    </p>
                  </div>
                  
                  <div className="pt-4">
                    <button
                      type="submit"
                      className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                    >
                      Add Bicycle
                    </button>
                  </div>
                </form>
              )}
              
              {/* Edit Bicycle Form */}
              {activeModal === 'editBicycle' && (
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">ID</label>
                    <input
                      type="text"
                      name="id"
                      value={formData.id || ''}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base bg-gray-100 dark:bg-dark-300"
                      disabled
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Name</label>
                    <input
                      type="text"
                      name="name"
                      value={formData.name || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Type</label>
                    <select
                      name="type"
                      value={formData.type || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    >
                      <option value="">Select Type</option>
                      <option value="Mountain">Mountain</option>
                      <option value="Road">Road</option>
                      <option value="Hybrid">Hybrid</option>
                      <option value="Cruiser">Cruiser</option>
                      <option value="Electric">Electric</option>
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Color</label>
                    <input
                      type="text"
                      name="color"
                      value={formData.color || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Daily Rate ($)</label>
                    <input
                      type="number"
                      name="ratePerDay"
                      value={formData.ratePerDay || ''}
                      onChange={handleInputChange}
                      min="1"
                      step="0.01"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Status</label>
                    <select
                      name="status"
                      value={formData.status || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    >
                      <option value="available">Available</option>
                      <option value="rented">Rented</option>
                      <option value="maintenance">Maintenance</option>
                    </select>
                  </div>
                  
                  <div className="pt-4">
                    <button
                      type="submit"
                      className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                    >
                      Update Bicycle
                    </button>
                  </div>
                </form>
              )}
              
              {/* Add User Form */}
              {activeModal === 'addUser' && (
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Full Name</label>
                    <input
                      type="text"
                      name="name"
                      value={formData.name || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
                    <input
                      type="email"
                      name="email"
                      value={formData.email || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Phone</label>
                    <input
                      type="tel"
                      name="phone"
                      value={formData.phone || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Address</label>
                    <textarea
                      name="address"
                      value={formData.address || ''}
                      onChange={handleInputChange}
                      rows="2"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Student ID (if applicable)</label>
                    <input
                      type="text"
                      name="studentId"
                      value={formData.studentId || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                    />
                  </div>
                  
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Passport Photo</label>
                      <input
                        type="file"
                        name="passportPhoto"
                        onChange={handleFileChange}
                        accept="image/*"
                        className="mt-1 block w-full text-sm text-gray-500 dark:text-gray-400
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-md file:border-0
                        file:text-sm file:font-semibold
                        file:bg-primary-50 file:text-primary-700
                        dark:file:bg-primary-900 dark:file:text-primary-200
                        hover:file:bg-primary-100 dark:hover:file:bg-primary-800"
                      />
                    </div>
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Personal Photo</label>
                      <input
                        type="file"
                        name="personalPhoto"
                        onChange={handleFileChange}
                        accept="image/*"
                        className="mt-1 block w-full text-sm text-gray-500 dark:text-gray-400
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-md file:border-0
                        file:text-sm file:font-semibold
                        file:bg-primary-50 file:text-primary-700
                        dark:file:bg-primary-900 dark:file:text-primary-200
                        hover:file:bg-primary-100 dark:hover:file:bg-primary-800"
                      />
                    </div>
                  </div>
                  
                  <div className="pt-4">
                    <button
                      type="submit"
                      className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                    >
                      Register User
                    </button>
                  </div>
                </form>
              )}
              
              {/* Edit User Form */}
              {activeModal === 'editUser' && (
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">ID</label>
                    <input
                      type="text"
                      name="id"
                      value={formData.id || ''}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base bg-gray-100 dark:bg-dark-300"
                      disabled
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Full Name</label>
                    <input
                      type="text"
                      name="name"
                      value={formData.name || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
                    <input
                      type="email"
                      name="email"
                      value={formData.email || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Phone</label>
                    <input
                      type="tel"
                      name="phone"
                      value={formData.phone || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Address</label>
                    <textarea
                      name="address"
                      value={formData.address || ''}
                      onChange={handleInputChange}
                      rows="2"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Student ID</label>
                    <input
                      type="text"
                      name="studentId"
                      value={formData.studentId || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                    />
                  </div>
                  
                  <div className="pt-4">
                    <button
                      type="submit"
                      className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                    >
                      Update User
                    </button>
                  </div>
                </form>
              )}
              
              {/* Verify User Form */}
              {activeModal === 'verifyUser' && (
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div className="flex items-center space-x-4">
                    <img src={formData.avatar} alt={formData.name} className="h-16 w-16 rounded-full" />
                    <div>
                      <h3 className="font-medium text-gray-900 dark:text-white">{formData.name}</h3>
                      <p className="text-sm text-gray-500 dark:text-gray-400">{formData.email}</p>
                    </div>
                  </div>
                  
                  <div className="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-md">
                    <p className="text-sm text-yellow-800 dark:text-yellow-200">
                      Are you sure you want to verify this user? This will allow them to rent bicycles.
                    </p>
                  </div>
                  
                  <div className="pt-4 flex space-x-3">
                    <button
                      type="button"
                      onClick={closeModal}
                      className="flex-1 py-2 px-4 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-dark-200 hover:bg-gray-50 dark:hover:bg-dark-300 focus:outline-none"
                    >
                      Cancel
                    </button>
                    
                    <button
                      type="submit"
                      className="flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none"
                    >
                      Verify User
                    </button>
                  </div>
                </form>
              )}
              
              {/* Report Maintenance Form */}
              {activeModal === 'reportMaintenance' && (
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Bicycle</label>
                    <select
                      name="bicycleId"
                      value={formData.bicycleId || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    >
                      <option value="">Select Bicycle</option>
                      {bicycles.map(bike => (
                        <option key={bike.id} value={bike.id}>
                          {bike.id} - {bike.name} ({bike.status})
                        </option>
                      ))}
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Issue Type</label>
                    <input
                      type="text"
                      name="issue"
                      value={formData.issue || ''}
                      onChange={handleInputChange}
                      placeholder="e.g. Flat tire, Brake adjustment"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Description</label>
                    <textarea
                      name="description"
                      value={formData.description || ''}
                      onChange={handleInputChange}
                      rows="3"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Estimated Cost ($)</label>
                    <input
                      type="number"
                      name="cost"
                      value={formData.cost || ''}
                      onChange={handleInputChange}
                      min="0"
                      step="0.01"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Damage Photos</label>
                    <input
                      type="file"
                      name="damagePhotos"
                      onChange={handleFileChange}
                      accept="image/*"
                      multiple
                      className="mt-1 block w-full text-sm text-gray-500 dark:text-gray-400
                      file:mr-4 file:py-2 file:px-4
                      file:rounded-md file:border-0
                      file:text-sm file:font-semibold
                      file:bg-primary-50 file:text-primary-700
                      dark:file:bg-primary-900 dark:file:text-primary-200
                      hover:file:bg-primary-100 dark:hover:file:bg-primary-800"
                    />
                  </div>
                  
                  <div className="pt-4">
                    <button
                      type="submit"
                      className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                    >
                      Report Issue
                    </button>
                  </div>
                </form>
              )}
              
              {/* Complete Maintenance Form */}
              {activeModal === 'completeMaintenance' && (
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Maintenance ID</label>
                    <input
                      type="text"
                      name="id"
                      value={formData.id || ''}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base bg-gray-100 dark:bg-dark-300"
                      disabled
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Bicycle</label>
                    <input
                      type="text"
                      value={
                        formData.bicycleId && bicycles.find(b => b.id === formData.bicycleId)
                          ? `${formData.bicycleId} - ${bicycles.find(b => b.id === formData.bicycleId).name}`
                          : formData.bicycleId || ''
                      }
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base bg-gray-100 dark:bg-dark-300"
                      disabled
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Issue</label>
                    <input
                      type="text"
                      value={formData.issue || ''}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base bg-gray-100 dark:bg-dark-300"
                      disabled
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Final Cost ($)</label>
                    <input
                      type="number"
                      name="cost"
                      value={formData.cost || ''}
                      onChange={handleInputChange}
                      min="0"
                      step="0.01"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Repair Notes</label>
                    <textarea
                      name="repairNotes"
                      value={formData.repairNotes || ''}
                      onChange={handleInputChange}
                      rows="3"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                    />
                  </div>
                  
                  <div className="pt-4">
                    <button
                      type="submit"
                      className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                    >
                      Complete Maintenance
                    </button>
                  </div>
                </form>
              )}
              
              {/* Make Payment Form */}
              {activeModal === 'makePayment' && (
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">User</label>
                    <select
                      name="userId"
                      value={formData.userId || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    >
                      <option value="">Select User</option>
                      {users.map(user => (
                        <option key={user.id} value={user.id}>
                          {user.id} - {user.name}
                        </option>
                      ))}
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Payment Type</label>
                    <select
                      name="type"
                      value={formData.type || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    >
                      <option value="">Select Type</option>
                      <option value="rental">Bicycle Rental</option>
                      <option value="membership">Membership Fee</option>
                      <option value="deposit">Security Deposit</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                  
                  {formData.type === 'rental' && (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Bicycle</label>
                      <select
                        name="bicycleId"
                        value={formData.bicycleId || ''}
                        onChange={handleInputChange}
                        className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                        required
                      >
                        <option value="">Select Bicycle</option>
                        {bicycles.map(bike => (
                          <option key={bike.id} value={bike.id}>
                            {bike.id} - {bike.name} (${bike.ratePerDay}/day)
                          </option>
                        ))}
                      </select>
                    </div>
                  )}
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Amount ($)</label>
                    <input
                      type="number"
                      name="amount"
                      value={formData.amount || ''}
                      onChange={handleInputChange}
                      min="1"
                      step="0.01"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Notes</label>
                    <textarea
                      name="notes"
                      value={formData.notes || ''}
                      onChange={handleInputChange}
                      rows="2"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                    />
                  </div>
                  
                  <div className="pt-4">
                    <button
                      type="submit"
                      className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                    >
                      Record Payment
                    </button>
                  </div>
                </form>
              )}
              
              {/* Assign Bicycle Form */}
              {activeModal === 'assignBicycle' && (
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">User</label>
                    <select
                      name="userId"
                      value={formData.userId || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    >
                      <option value="">Select User</option>
                      {users.filter(user => user.status === 'verified').map(user => (
                        <option key={user.id} value={user.id}>
                          {user.id} - {user.name}
                        </option>
                      ))}
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Bicycle</label>
                    <select
                      name="bicycleId"
                      value={formData.bicycleId || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    >
                      <option value="">Select Bicycle</option>
                      {bicycles.filter(bike => bike.status === 'available').map(bike => (
                        <option key={bike.id} value={bike.id}>
                          {bike.id} - {bike.name} (${bike.ratePerDay}/day)
                        </option>
                      ))}
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Rental Duration (days)</label>
                    <input
                      type="number"
                      name="rentalDays"
                      value={formData.rentalDays || ""}
                      onChange={handleInputChange}
                      min="1"
                      max="30"
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    />
                  </div>
                  
                  {formData.bicycleId && formData.rentalDays && (
                    <div className="bg-gray-50 dark:bg-dark-300 p-3 rounded-md">
                      <p className="text-sm text-gray-700 dark:text-gray-300">
                        Rental Cost: ${
                          (bicycles.find(b => b.id === formData.bicycleId)?.ratePerDay || 0) * (formData.rentalDays || 0)
                        }
                      </p>
                    </div>
                  )}
                  
                  <div className="pt-4">
                    <button
                      type="submit"
                      className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                    >
                      Assign Bicycle
                    </button>
                  </div>
                </form>
              )}
              
              {/* Return Bicycle Form */}
              {activeModal === 'returnBicycle' && (
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">User</label>
                    <select
                      name="userId"
                      value={formData.userId || ''}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    >
                      <option value="">Select User</option>
                      {users.filter(user => user.rentals && user.rentals.length > 0).map(user => (
                        <option key={user.id} value={user.id}>
                          {user.id} - {user.name}
                        </option>
                      ))}
                    </select>
                  </div>
                  
                  {formData.userId && (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Bicycle to Return</label>
                      <select
                        name="bicycleId"
                        value={formData.bicycleId || ''}
                        onChange={handleInputChange}
                        className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                        required
                      >
                        <option value="">Select Bicycle</option>
                        {users.find(u => u.id === formData.userId)?.rentals.map(bikeId => {
                          const bike = bicycles.find(b => b.id === bikeId);
                          return bike ? (
                            <option key={bike.id} value={bike.id}>
                              {bike.id} - {bike.name}
                            </option>
                          ) : null;
                        })}
                      </select>
                    </div>
                  )}
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Condition on Return</label>
                    <select
                      name="condition"
                      value={formData.condition || 'good'}
                      onChange={handleInputChange}
                      className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                      required
                    >
                      <option value="good">Good - No Issues</option>
                      <option value="fair">Fair - Minor Issues</option>
                      <option value="poor">Poor - Needs Maintenance</option>
                    </select>
                  </div>
                  
                  {formData.condition === 'fair' || formData.condition === 'poor' ? (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Issues Description</label>
                      <textarea
                        name="issuesDescription"
                        value={formData.issuesDescription || ''}
                        onChange={handleInputChange}
                        rows="2"
                        className="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-dark-200 dark:text-white text-base"
                        required
                      />
                    </div>
                  ) : null}
                  
                  <div className="pt-4">
                    <button
                      type="submit"
                      className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                    >
                      Return Bicycle
                    </button>
                  </div>
                </form>
              )}
              
              {/* Bicycle Details */}
              {activeModal === 'bicycleDetails' && modalData && (
                <div className="space-y-4">
                  <div className="flex justify-center">
                    <img src={modalData.image} alt={modalData.name} className="h-40 object-contain mb-2" />
                  </div>
                  
                  <div className="space-y-2">
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">ID:</span>
                      <span className="font-medium">{modalData.id}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Name:</span>
                      <span className="font-medium">{modalData.name}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Type:</span>
                      <span className="font-medium">{modalData.type}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Color:</span>
                      <span className="font-medium">{modalData.color}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Daily Rate:</span>
                      <span className="font-medium">${modalData.ratePerDay}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Status:</span>
                      <span className={`font-medium ${
                        modalData.status === 'available' ? 'text-green-600 dark:text-green-400' :
                        modalData.status === 'rented' ? 'text-blue-600 dark:text-blue-400' :
                        'text-red-600 dark:text-red-400'
                      }`}>
                        {modalData.status.charAt(0).toUpperCase() + modalData.status.slice(1)}
                      </span>
                    </div>
                  </div>
                  
                  <div className="mt-4">
                    <h3 className="text-lg font-medium text-gray-900 dark:text-white">Maintenance History</h3>
                    {modalData.maintenance && modalData.maintenance.length > 0 ? (
                      <ul className="mt-2 space-y-2">
                        {modalData.maintenance.map((item, index) => (
                          <li key={index} className="border-l-4 border-primary-500 pl-4 py-1">
                            <div className="text-sm text-gray-600 dark:text-gray-400">{item.date}</div>
                            <div className="font-medium">{item.issue}</div>
                            <div className="text-sm">Cost: ${item.cost}</div>
                          </li>
                        ))}
                      </ul>
                    ) : (
                      <p className="text-gray-500 dark:text-gray-400 mt-2">No maintenance records found.</p>
                    )}
                  </div>
                  
                  <div className="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <h3 className="text-lg font-medium text-gray-900 dark:text-white mb-2">QR Code</h3>
                    <div className="bg-white p-4 rounded-lg flex justify-center qr-animation">
                      {/* Simple QR code representation */}
                      <div className="w-32 h-32 grid grid-cols-6 grid-rows-6 gap-1">
                        {Array(36).fill().map((_, i) => (
                          <div key={i} className={`bg-black ${i % 3 === 0 ? 'rounded-sm' : ''}`}></div>
                        ))}
                      </div>
                    </div>
                    <p className="text-center text-sm text-gray-500 dark:text-gray-400 mt-2">
                      Scan this code to quickly access bicycle information
                    </p>
                  </div>
                  
                  <div className="mt-6 flex space-x-3">
                    <button
                      onClick={() => {
                        closeModal();
                        openModal('editBicycle', modalData);
                      }}
                      className="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-secondary-600 hover:bg-secondary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary-500"
                    >
                      <i className="fas fa-edit mr-2"></i> Edit Bicycle
                    </button>
                    
                    <button
                      onClick={() => {
                        closeModal();
                        openModal('reportMaintenance', { bicycleId: modalData.id });
                      }}
                      className="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-accent-600 hover:bg-accent-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-500"
                    >
                      <i className="fas fa-wrench mr-2"></i> Report Issue
                    </button>
                  </div>
                </div>
              )}
              
              {/* User Details */}
              {activeModal === 'userDetails' && modalData && (
                <div className="space-y-4">
                  <div className="flex justify-center">
                    <img src={modalData.avatar} alt={modalData.name} className="h-24 w-24 rounded-full border-4 border-primary-200 dark:border-primary-900" />
                  </div>
                  
                  <div className="text-center">
                    <h3 className="font-bold text-xl">{modalData.name}</h3>
                    <p className="text-gray-600 dark:text-gray-400">
                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        modalData.status === 'verified' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'
                      }`}>
                        {modalData.status === 'verified' ? 'Verified' : 'Pending Verification'}
                      </span>
                    </p>
                  </div>
                  
                  <div className="space-y-2">
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">ID:</span>
                      <span className="font-medium">{modalData.id}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Email:</span>
                      <span className="font-medium">{modalData.email}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Phone:</span>
                      <span className="font-medium">{modalData.phone}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-600 dark:text-gray-400">Address:</span>
                      <span className="font-medium">{modalData.address}</span>
                    </div>
                    {modalData.studentId && (
                      <div className="flex justify-between">
                        <span className="text-gray-600 dark:text-gray-400">Student ID:</span>
                        <span className="font-medium">{modalData.studentId}</span>
                      </div>
                    )}
                  </div>
                  
                  <div className="mt-4">
                    <h3 className="text-lg font-medium text-gray-900 dark:text-white">Current Rentals</h3>
                    {modalData.rentals && modalData.rentals.length > 0 ? (
                      <ul className="mt-2 space-y-2">
                        {modalData.rentals.map((rentalId) => {
                          const bike = bicycles.find(b => b.id === rentalId);
                          return bike ? (
                            <li key={rentalId} className="flex items-center justify-between p-2 bg-gray-50 dark:bg-dark-300 rounded-lg">
                              <div>
                                <div className="font-medium">{bike.name}</div>
                                <div className="text-sm text-gray-600 dark:text-gray-400">{bike.id}</div>
                              </div>
                              <div className="flex items-center">
                                <span className="text-primary-600 dark:text-primary-400 mr-4">${bike.ratePerDay}/day</span>
                                <button 
                                  onClick={(e) => {
                                    e.stopPropagation();
                                    closeModal();
                                    openModal('returnBicycle', { userId: modalData.id, bicycleId: rentalId });
                                  }}
                                  className="text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 px-2 py-1 rounded-md hover:bg-blue-200 dark:hover:bg-blue-800"
                                >
                                  Return
                                </button>
                              </div>
                            </li>
                          ) : null;
                        })}
                      </ul>
                    ) : (
                      <p className="text-gray-500 dark:text-gray-400 mt-2">No active rentals.</p>
                    )}
                  </div>
                  
                  <div className="mt-6 flex space-x-3">
                    <button
                      onClick={() => {
                        closeModal();
                        openModal('editUser', modalData);
                      }}
                      className="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-secondary-600 hover:bg-secondary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary-500"
                    >
                      <i className="fas fa-edit mr-2"></i> Edit Profile
                    </button>
                    
                    {modalData.status === 'pending' ? (
                      <button
                        onClick={() => {
                          closeModal();
                          openModal('verifyUser', modalData);
                        }}
                        className="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"
                      >
                        <i className="fas fa-check-circle mr-2"></i> Verify User
                      </button>
                    ) : (
                      <button
                        onClick={() => {
                          closeModal();
                          openModal('assignBicycle', { userId: modalData.id });
                        }}
                        className="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                      >
                        <i className="fas fa-bicycle mr-2"></i> Assign Bicycle
                      </button>
                    )}
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };
    
    // Notifications Component
    const Notifications = () => {
      const { notifications } = useContext(AppContext);
      
      return (
        <div className="fixed bottom-4 right-4 z-40 space-y-2 max-w-xs w-full">
          {notifications.map(notification => (
            <div 
              key={notification.id}
              className={`rounded-lg shadow-lg px-4 py-3 transform transition-all duration-300 ease-in-out animate-fade-in ${
                notification.type === 'success' ? 'bg-green-500 text-white' :
                notification.type === 'error' ? 'bg-red-500 text-white' :
                notification.type === 'warning' ? 'bg-yellow-500 text-white' :
                'bg-primary-500 text-white'
              }`}
            >
              <div className="flex justify-between items-start">
                <div className="flex items-center">
                  <i className={`mr-2 ${
                    notification.type === 'success' ? 'fas fa-check-circle' :
                    notification.type === 'error' ? 'fas fa-exclamation-circle' :
                    notification.type === 'warning' ? 'fas fa-exclamation-triangle' :
                    'fas fa-info-circle'
                  }`}></i>
                  <p className="text-sm font-medium">{notification.message}</p>
                </div>
              </div>
            </div>
          ))}
        </div>
      );
    };
    
    // Navigation Component
    const Navigation = () => {
      const { activePage, setActivePage, darkMode, setDarkMode } = useContext(AppContext);
      const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
      
      const navLinks = [
        { id: 'dashboard', name: 'Dashboard', icon: 'fas fa-tachometer-alt' },
        { id: 'bicycles', name: 'Bicycles', icon: 'fas fa-bicycle' },
        { id: 'users', name: 'Users', icon: 'fas fa-users' },
        { id: 'maintenance', name: 'Maintenance', icon: 'fas fa-wrench' },
        { id: 'finance', name: 'Finance', icon: 'fas fa-money-bill-wave' },
        { id: 'reports', name: 'Reports', icon: 'fas fa-chart-bar' }
      ];
      
      return (
        <>
          {/* Desktop Navigation */}
          <div className="hidden md:flex md:flex-col md:fixed md:h-screen bg-white dark:bg-dark-100 shadow-md z-20 transition-all duration-300 w-64">
            <div className="flex items-center justify-center h-16 border-b border-gray-200 dark:border-gray-800">
              <div className="px-4 flex items-center">
                <i className="fas fa-bicycle text-primary-600 dark:text-primary-400 text-2xl mr-2"></i>
                <h1 className="text-xl font-bold text-gray-900 dark:text-white">EBike</h1>
              </div>
            </div>
            
            <div className="flex-1 overflow-y-auto">
              <nav className="mt-5 px-2 space-y-1">
                {navLinks.map(link => (
                  <button
                    key={link.id}
                    onClick={() => setActivePage(link.id)}
                    className={`group flex items-center px-4 py-3 text-sm font-medium rounded-md w-full transition-all ${
                      activePage === link.id
                        ? 'bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-100'
                        : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-200'
                    }`}
                  >
                    <i className={`${link.icon} ${
                      activePage === link.id 
                        ? 'text-primary-700 dark:text-primary-300' 
                        : 'text-gray-500 dark:text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300'
                    } mr-3 text-lg`}></i>
                    {link.name}
                  </button>
                ))}
              </nav>
            </div>
            
            <div className="border-t border-gray-200 dark:border-gray-800 p-4">
              <button
                onClick={() => setDarkMode(!darkMode)}
                className="flex items-center justify-center w-full px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-dark-300 rounded-md hover:bg-gray-200 dark:hover:bg-dark-200 transition-colors"
              >
                <i className={`${darkMode ? 'fas fa-sun' : 'fas fa-moon'} mr-2`}></i>
                {darkMode ? 'Light Mode' : 'Dark Mode'}
              </button>
              
              <div className="mt-4 flex items-center">
                <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'><circle cx='20' cy='15' r='10' fill='%235D5CDE'/><circle cx='20' cy='45' r='20' fill='%235D5CDE'/></svg>" alt="Admin" className="h-9 w-9 rounded-full" />
                <div className="ml-3">
                  <p className="text-sm font-medium text-gray-700 dark:text-gray-200">Admin User</p>
                  <p className="text-xs text-gray-500 dark:text-gray-400">System Admin</p>
                </div>
              </div>
            </div>
          </div>
          
          {/* Mobile Navigation Bar */}
          <div className="md:hidden bg-white dark:bg-dark-100 shadow-md fixed top-0 inset-x-0 z-20">
            <div className="flex items-center justify-between h-16 px-4">
              <div className="flex items-center">
                <i className="fas fa-bicycle text-primary-600 dark:text-primary-400 text-2xl mr-2"></i>
                <h1 className="text-xl font-bold text-gray-900 dark:text-white">EBike</h1>
              </div>
              
              <div className="flex items-center space-x-3">
                <button
                  onClick={() => setDarkMode(!darkMode)}
                  className="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"
                >
                  <i className={`${darkMode ? 'fas fa-sun' : 'fas fa-moon'} text-xl`}></i>
                </button>
                
                <button
                  onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                  className="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"
                >
                  <i className={`${mobileMenuOpen ? 'fas fa-times' : 'fas fa-bars'} text-xl`}></i>
                </button>
              </div>
            </div>
            
            {/* Mobile Menu */}
            {mobileMenuOpen && (
              <div className="bg-white dark:bg-dark-100 shadow-md py-2 px-4 absolute w-full animate-fade-in">
                <nav className="grid grid-cols-2 gap-2 py-2">
                  {navLinks.map(link => (
                    <button
                      key={link.id}
                      onClick={() => {
                        setActivePage(link.id);
                        setMobileMenuOpen(false);
                      }}
                      className={`flex flex-col items-center px-2 py-3 text-sm font-medium rounded-md transition-all ${
                        activePage === link.id
                          ? 'bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-100'
                          : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-dark-200'
                      }`}
                    >
                      <i className={`${link.icon} text-xl mb-1 ${
                        activePage === link.id 
                          ? 'text-primary-700 dark:text-primary-300' 
                          : 'text-gray-500 dark:text-gray-400'
                      }`}></i>
                      {link.name}
                    </button>
                  ))}
                </nav>
                
                <div className="mt-2 pt-2 border-t border-gray-200 dark:border-gray-800">
                  <div className="flex items-center py-2">
                    <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'><circle cx='20' cy='15' r='10' fill='%235D5CDE'/><circle cx='20' cy='45' r='20' fill='%235D5CDE'/></svg>" alt="Admin" className="h-9 w-9 rounded-full" />
                    <div className="ml-3">
                      <p className="text-sm font-medium text-gray-700 dark:text-gray-200">Admin User</p>
                      <p className="text-xs text-gray-500 dark:text-gray-400">System Admin</p>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        </>
      );
    };
    
    // Dashboard Component
    const Dashboard = () => {
      const { bicycles, users, bicycleStatusCounts, financialMetrics, recentActivity, openModal } = useContext(AppContext);
      const [selectedPeriod, setSelectedPeriod] = useState('month');
      
      // Refs for charts
      const bikeStatusChartRef = useRef(null);
      const revenueChartRef = useRef(null);
      
      // Chart instances
      const chartInstances = useRef({
        bikeStatus: null,
        revenue: null
      });
      
      // Format date for activity items
      const formatActivityDate = (timestamp) => {
        const date = new Date(timestamp);
        const now = new Date();
        const diffInHours = Math.floor((now - date) / (1000 * 60 * 60));
        
        if (diffInHours < 24) {
          if (diffInHours === 0) {
            return 'Today, ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          }
          return 'Today, ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        } else if (diffInHours < 48) {
          return 'Yesterday, ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        } else {
          return date.toLocaleDateString([], { day: '2-digit', month: 'short', year: 'numeric' }) + ', ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
      };
      
      // Get activity icon based on type
      const getActivityIcon = (type) => {
        switch (type) {
          case 'rental':
            return 'fas fa-bicycle bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300';
          case 'return':
            return 'fas fa-undo bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300';
          case 'maintenance':
          case 'maintenance_completed':
            return 'fas fa-wrench bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300';
          case 'payment':
          case 'payment_updated':
            return 'fas fa-dollar-sign bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300';
          case 'user':
            return 'fas fa-user-plus bg-primary-100 dark:bg-primary-900 text-primary-600 dark:text-primary-300';
          case 'bicycle':
            return 'fas fa-bicycle bg-accent-100 dark:bg-accent-900 text-accent-600 dark:text-accent-300';
          default:
            return 'fas fa-info-circle bg-gray-100 dark:bg-gray-900 text-gray-600 dark:text-gray-300';
        }
      };
      
      // Initialize and update charts
      useEffect(() => {
        if (bikeStatusChartRef.current && revenueChartRef.current) {
          // Destroy existing charts
          if (chartInstances.current.bikeStatus) {
            chartInstances.current.bikeStatus.destroy();
          }
          
          if (chartInstances.current.revenue) {
            chartInstances.current.revenue.destroy();
          }
          
          // Bike Status Chart
          chartInstances.current.bikeStatus = new Chart(bikeStatusChartRef.current, {
            type: 'doughnut',
            data: {
              labels: ['Available', 'Rented', 'Maintenance'],
              datasets: [{
                data: [
                  bicycleStatusCounts.available || 0,
                  bicycleStatusCounts.rented || 0,
                  bicycleStatusCounts.maintenance || 0
                ],
                backgroundColor: [
                  '#10b981', // green
                  '#3b82f6', // blue
                  '#ef4444'  // red
                ],
                borderWidth: 0
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'bottom',
                  labels: {
                    padding: 20,
                    boxWidth: 12,
                    color: document.documentElement.classList.contains('dark') ? '#e5e7eb' : '#4b5563'
                  }
                }
              },
              cutout: '70%'
            }
          });
          
          // Revenue Chart (Mock data for different periods)
          const revenueData = {
            week: {
              labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
              datasets: [{
                label: 'Revenue',
                data: [65, 59, 80, 81, 56, 55, 40],
                borderColor: '#8b5cf6',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                tension: 0.4,
                fill: true
              }]
            },
            month: {
              labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
              datasets: [{
                label: 'Revenue',
                data: [300, 450, 380, 500],
                borderColor: '#8b5cf6',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                tension: 0.4,
                fill: true
              }]
            },
            year: {
              labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
              datasets: [{
                label: 'Revenue',
                data: [500, 600, 550, 700, 800, 750, 850, 900, 950, 1000, 1100, 1200],
                borderColor: '#8b5cf6',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                tension: 0.4,
                fill: true
              }]
            }
          };
          
          chartInstances.current.revenue = new Chart(revenueChartRef.current, {
            type: 'line',
            data: revenueData[selectedPeriod],
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: {
                  grid: {
                    display: false,
                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                  },
                  ticks: {
                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#4b5563'
                  }
                },
                y: {
                  beginAtZero: true,
                  grid: {
                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                  },
                  ticks: {
                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#4b5563'
                  }
                }
              },
              plugins: {
                legend: {
                  display: false
                }
              }
            }
          });
        }
        
        // Cleanup
        return () => {
          if (chartInstances.current.bikeStatus) {
            chartInstances.current.bikeStatus.destroy();
          }
          
          if (chartInstances.current.revenue) {
            chartInstances.current.revenue.destroy();
          }
        };
      }, [bicycleStatusCounts, selectedPeriod]);
      
      return (
        <div className="p-4 md:p-6 animate-fade-in">
          <div className="mb-6">
            <h1 className="text-2xl font-bold text-gray-900 dark:text-white">Dashboard</h1>
            <p className="text-gray-600 dark:text-gray-400 mt-1">Overview of your rental business</p>
          </div>
          
          {/* Quick Stats */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-gray-500 dark:text-gray-400 text-sm">Total Bicycles</p>
                  <h3 className="text-2xl font-bold mt-1 text-gray-900 dark:text-white">{bicycles.length}</h3>
                </div>
                <div className="bg-primary-100 dark:bg-primary-900 p-2 rounded-md">
                  <i className="fas fa-bicycle text-primary-600 dark:text-primary-300 text-xl"></i>
                </div>
              </div>
              <div className="mt-2 flex items-center text-sm">
                <span className="text-green-500 flex items-center">
                  <i className="fas fa-arrow-up mr-1"></i> 12%
                </span>
                <span className="text-gray-400 dark:text-gray-500 ml-2">from last month</span>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-gray-500 dark:text-gray-400 text-sm">Active Users</p>
                  <h3 className="text-2xl font-bold mt-1 text-gray-900 dark:text-white">{users.length}</h3>
                </div>
                <div className="bg-blue-100 dark:bg-blue-900 p-2 rounded-md">
                  <i className="fas fa-users text-blue-600 dark:text-blue-300 text-xl"></i>
                </div>
              </div>
              <div className="mt-2 flex items-center text-sm">
                <span className="text-green-500 flex items-center">
                  <i className="fas fa-arrow-up mr-1"></i> 8%
                </span>
                <span className="text-gray-400 dark:text-gray-500 ml-2">from last month</span>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-gray-500 dark:text-gray-400 text-sm">Total Revenue</p>
                  <h3 className="text-2xl font-bold mt-1 text-gray-900 dark:text-white">${financialMetrics.totalRevenue}</h3>
                </div>
                <div className="bg-green-100 dark:bg-green-900 p-2 rounded-md">
                  <i className="fas fa-dollar-sign text-green-600 dark:text-green-300 text-xl"></i>
                </div>
              </div>
              <div className="mt-2 flex items-center text-sm">
                <span className="text-green-500 flex items-center">
                  <i className="fas fa-arrow-up mr-1"></i> 15%
                </span>
                <span className="text-gray-400 dark:text-gray-500 ml-2">from last month</span>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-gray-500 dark:text-gray-400 text-sm">Maintenance Cost</p>
                  <h3 className="text-2xl font-bold mt-1 text-gray-900 dark:text-white">${financialMetrics.maintenanceCosts}</h3>
                </div>
                <div className="bg-red-100 dark:bg-red-900 p-2 rounded-md">
                  <i className="fas fa-wrench text-red-600 dark:text-red-300 text-xl"></i>
                </div>
              </div>
              <div className="mt-2 flex items-center text-sm">
                <span className="text-red-500 flex items-center">
                  <i className="fas fa-arrow-up mr-1"></i> 5%
                </span>
                <span className="text-gray-400 dark:text-gray-500 ml-2">from last month</span>
              </div>
            </div>
          </div>
          
          {/* Charts & Recent Activity */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            {/* Bicycle Status Chart */}
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Bicycle Status</h3>
              <div className="h-64 relative">
                <canvas ref={bikeStatusChartRef}></canvas>
                <div className="absolute inset-0 flex items-center justify-center flex-col">
                  <span className="text-3xl font-bold text-gray-900 dark:text-white">{bicycles.length}</span>
                  <span className="text-sm text-gray-500 dark:text-gray-400">Total</span>
                </div>
              </div>
              <div className="grid grid-cols-3 mt-4 text-center">
                <div>
                  <p className="text-sm text-gray-500 dark:text-gray-400">Available</p>
                  <p className="font-semibold text-green-600 dark:text-green-400">{bicycleStatusCounts.available || 0}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-500 dark:text-gray-400">Rented</p>
                  <p className="font-semibold text-blue-600 dark:text-blue-400">{bicycleStatusCounts.rented || 0}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-500 dark:text-gray-400">Maintenance</p>
                  <p className="font-semibold text-red-600 dark:text-red-400">{bicycleStatusCounts.maintenance || 0}</p>
                </div>
              </div>
            </div>
            
            {/* Revenue Chart */}
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800 lg:col-span-2">
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-lg font-semibold text-gray-900 dark:text-white">Revenue Overview</h3>
                <div className="flex space-x-2">
                  <button 
                    onClick={() => setSelectedPeriod('week')}
                    className={`px-3 py-1 text-xs rounded-md ${
                      selectedPeriod === 'week' 
                        ? 'bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300' 
                        : 'text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-dark-200'
                    }`}
                  >
                    Week
                  </button>
                  <button 
                    onClick={() => setSelectedPeriod('month')}
                    className={`px-3 py-1 text-xs rounded-md ${
                      selectedPeriod === 'month' 
                        ? 'bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300' 
                        : 'text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-dark-200'
                    }`}
                  >
                    Month
                  </button>
                  <button 
                    onClick={() => setSelectedPeriod('year')}
                    className={`px-3 py-1 text-xs rounded-md ${
                      selectedPeriod === 'year' 
                        ? 'bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300' 
                        : 'text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-dark-200'
                    }`}
                  >
                    Year
                  </button>
                </div>
              </div>
              <div className="h-64">
                <canvas ref={revenueChartRef}></canvas>
              </div>
            </div>
          </div>
          
          {/* Recent Activity & Quick Actions */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Recent Activity */}
                      <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800 lg:col-span-2">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Recent Activity</h3>
              <div className="space-y-4">
                {recentActivity.length > 0 ? (
                  recentActivity.slice(0, 4).map(activity => (
                    <div key={activity.id} className="flex items-start p-3 rounded-lg bg-gray-50 dark:bg-dark-200">
                      <div className={`p-2 rounded-md ${getActivityIcon(activity.type)}`}>
                        <i className={getActivityIcon(activity.type).split(' ')[0]}></i>
                      </div>
                      <div className="ml-4">
                        <p className="text-sm font-medium text-gray-900 dark:text-white">{activity.message}</p>
                        <p className="text-xs text-gray-500 dark:text-gray-400">{formatActivityDate(activity.timestamp)}</p>
                      </div>
                    </div>
                  ))
                ) : (
                  <div className="flex flex-col items-center justify-center py-4">
                    <p className="text-gray-500 dark:text-gray-400">No recent activity</p>
                  </div>
                )}
              </div>
              <button 
                onClick={() => setActivePage('reports')}
                className="mt-4 text-primary-600 dark:text-primary-400 text-sm font-medium flex items-center"
              >
                View all activity
                <i className="fas fa-arrow-right ml-1 text-xs"></i>
              </button>
            </div>
            
            {/* Quick Actions */}
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Quick Actions</h3>
              <div className="space-y-3">
                <button
                  onClick={() => openModal('addBicycle')}
                  className="w-full flex items-center justify-between p-3 bg-primary-50 dark:bg-primary-900/30 rounded-lg text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/50 transition-colors"
                >
                  <span className="flex items-center">
                    <i className="fas fa-bicycle mr-3"></i>
                    Add New Bicycle
                  </span>
                  <i className="fas fa-chevron-right text-xs"></i>
                </button>
                
                <button
                  onClick={() => openModal('addUser')}
                  className="w-full flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-blue-700 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors"
                >
                  <span className="flex items-center">
                    <i className="fas fa-user-plus mr-3"></i>
                    Register New User
                  </span>
                  <i className="fas fa-chevron-right text-xs"></i>
                </button>
                
                <button
                  onClick={() => openModal('reportMaintenance')}
                  className="w-full flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/30 rounded-lg text-red-700 dark:text-red-300 hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors"
                >
                  <span className="flex items-center">
                    <i className="fas fa-wrench mr-3"></i>
                    Report Maintenance
                  </span>
                  <i className="fas fa-chevron-right text-xs"></i>
                </button>
                
                <button
                  onClick={() => openModal('makePayment')}
                  className="w-full flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/30 rounded-lg text-green-700 dark:text-green-300 hover:bg-green-100 dark:hover:bg-green-900/50 transition-colors"
                >
                  <span className="flex items-center">
                    <i className="fas fa-money-bill-wave mr-3"></i>
                    Record Payment
                  </span>
                  <i className="fas fa-chevron-right text-xs"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    // Bicycles Component
    const Bicycles = () => {
      const { bicycles, openModal, deleteBicycle } = useContext(AppContext);
      const [searchTerm, setSearchTerm] = useState('');
      const [filterStatus, setFilterStatus] = useState('all');
      const [sortBy, setSortBy] = useState('name');
      const [sortDirection, setSortDirection] = useState('asc');
      
      // Handle sort change
      const handleSortChange = (field) => {
        if (sortBy === field) {
          setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
        } else {
          setSortBy(field);
          setSortDirection('asc');
        }
      };
      
      // Filter bicycles based on search and status
      const filteredBicycles = bicycles.filter(bike => {
        const matchesSearch = 
          bike.id.toLowerCase().includes(searchTerm.toLowerCase()) ||
          bike.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
          bike.type.toLowerCase().includes(searchTerm.toLowerCase());
        
        const matchesStatus = filterStatus === 'all' || bike.status === filterStatus;
        
        return matchesSearch && matchesStatus;
      });
      
      // Sort bicycles
      const sortedBicycles = [...filteredBicycles].sort((a, b) => {
        let comparison = 0;
        
        switch (sortBy) {
          case 'name':
            comparison = a.name.localeCompare(b.name);
            break;
          case 'type':
            comparison = a.type.localeCompare(b.type);
            break;
          case 'rate':
            comparison = a.ratePerDay - b.ratePerDay;
            break;
          case 'status':
            comparison = a.status.localeCompare(b.status);
            break;
          default:
            comparison = 0;
        }
        
        return sortDirection === 'asc' ? comparison : -comparison;
      });
      
      const handleDeleteBicycle = (e, bikeId) => {
        e.stopPropagation();
        if (window.confirm("Are you sure you want to delete this bicycle?")) {
          deleteBicycle(bikeId);
        }
      };
      
      return (
        <div className="p-4 md:p-6 animate-fade-in">
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
            <div>
              <h1 className="text-2xl font-bold text-gray-900 dark:text-white">Bicycles</h1>
              <p className="text-gray-600 dark:text-gray-400 mt-1">Manage your bicycle inventory</p>
            </div>
            
            <button
              onClick={() => openModal('addBicycle')}
              className="mt-4 sm:mt-0 flex items-center justify-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors"
            >
              <i className="fas fa-plus mr-2"></i>
              Add Bicycle
            </button>
          </div>
          
          {/* Filters */}
          <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 mb-6 border border-gray-200 dark:border-gray-800">
            <div className="flex flex-col md:flex-row gap-4">
              <div className="flex-1">
                <label htmlFor="search" className="sr-only">Search</label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i className="fas fa-search text-gray-400"></i>
                  </div>
                  <input
                    id="search"
                    type="text"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    placeholder="Search bicycles..."
                    className="block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md leading-5 bg-white dark:bg-dark-200 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-base"
                  />
                </div>
              </div>
              
              <div className="flex-none w-full md:w-48">
                <label htmlFor="status-filter" className="sr-only">Status Filter</label>
                <select
                  id="status-filter"
                  value={filterStatus}
                  onChange={(e) => setFilterStatus(e.target.value)}
                  className="block w-full pl-3 pr-10 py-2 border border-gray-300 dark:border-gray-700 rounded-md leading-5 bg-white dark:bg-dark-200 text-gray-900 dark:text-white focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-base"
                >
                  <option value="all">All Status</option>
                  <option value="available">Available</option>
                  <option value="rented">Rented</option>
                  <option value="maintenance">Maintenance</option>
                </select>
              </div>
              
              <div className="flex-none w-full md:w-48">
                <label htmlFor="sort-by" className="sr-only">Sort By</label>
                <select
                  id="sort-by"
                  value={`${sortBy}-${sortDirection}`}
                  onChange={(e) => {
                    const [field, direction] = e.target.value.split('-');
                    setSortBy(field);
                    setSortDirection(direction);
                  }}
                  className="block w-full pl-3 pr-10 py-2 border border-gray-300 dark:border-gray-700 rounded-md leading-5 bg-white dark:bg-dark-200 text-gray-900 dark:text-white focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-base"
                >
                  <option value="name-asc">Name (A-Z)</option>
                  <option value="name-desc">Name (Z-A)</option>
                  <option value="type-asc">Type (A-Z)</option>
                  <option value="rate-asc">Rate (Low to High)</option>
                  <option value="rate-desc">Rate (High to Low)</option>
                  <option value="status-asc">Status</option>
                </select>
              </div>
            </div>
          </div>
          
          {/* Bicycles Grid */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            {sortedBicycles.length > 0 ? (
              sortedBicycles.map(bike => (
                <div 
                  key={bike.id}
                  onClick={() => openModal('bicycleDetails', bike)}
                  className="bg-white dark:bg-dark-100 rounded-lg shadow-sm overflow-hidden border border-gray-200 dark:border-gray-800 hover:shadow-md transition-shadow cursor-pointer card"
                >
                  <div className="p-4">
                    <div className="relative h-48 mb-4 bg-gray-100 dark:bg-dark-200 rounded-md overflow-hidden flex items-center justify-center">
                      <img src={bike.image || "https://i.ebayimg.com/images/g/pFoAAOSwH-xm0Wzz/s-l1600.webp"} alt={bike.name} className="h-full object-contain" />
                      <div className={`absolute top-2 right-2 px-2 py-1 rounded-full text-xs font-medium ${
                        bike.status === 'available' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :
                        bike.status === 'rented' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' :
                        'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'
                      }`}>
                        {bike.status.charAt(0).toUpperCase() + bike.status.slice(1)}
                      </div>
                    </div>
                    
                    <div className="flex justify-between items-start">
                      <h3 className="font-semibold text-gray-900 dark:text-white">{bike.name}</h3>
                      <div className="flex space-x-1">
                        <button 
                          onClick={(e) => {
                            e.stopPropagation();
                            openModal('editBicycle', bike);
                          }}
                          className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
                        >
                          <i className="fas fa-edit"></i>
                        </button>
                        {bike.status !== 'rented' && (
                          <button 
                            onClick={(e) => handleDeleteBicycle(e, bike.id)}
                            className="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-200"
                          >
                            <i className="fas fa-trash-alt"></i>
                          </button>
                        )}
                      </div>
                    </div>
                    
                    <div className="flex justify-between items-center mt-1 text-sm">
                      <span className="text-gray-600 dark:text-gray-400">{bike.type}</span>
                      <span className="font-medium text-primary-600 dark:text-primary-400">${bike.ratePerDay}/day</span>
                    </div>
                    
                    <div className="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center">
                      <span className="text-xs text-gray-500 dark:text-gray-400">{bike.id}</span>
                      <span className="text-xs text-gray-500 dark:text-gray-400">{bike.color}</span>
                    </div>
                  </div>
                </div>
              ))
            ) : (
              <div className="col-span-full flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400">
                <i className="fas fa-search text-4xl mb-4"></i>
                <p className="text-lg font-medium">No bicycles found</p>
                <p className="text-sm mt-1">Try adjusting your search or filters</p>
              </div>
            )}
          </div>
        </div>
      );
    };
    
    // Users Component
    const Users = () => {
      const { users, openModal, deleteUser } = useContext(AppContext);
      const [searchTerm, setSearchTerm] = useState('');
      const [filterStatus, setFilterStatus] = useState('all');
      
      // Filter users based on search and status
      const filteredUsers = users.filter(user => {
        const matchesSearch = 
          user.id.toLowerCase().includes(searchTerm.toLowerCase()) ||
          user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
          user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
          (user.studentId && user.studentId.toLowerCase().includes(searchTerm.toLowerCase()));
        
        const matchesStatus = filterStatus === 'all' || user.status === filterStatus;
        
        return matchesSearch && matchesStatus;
      });
      
      const handleDeleteUser = (e, userId) => {
        e.stopPropagation();
        if (window.confirm("Are you sure you want to delete this user?")) {
          deleteUser(userId);
        }
      };
      
      return (
        <div className="p-4 md:p-6 animate-fade-in">
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
            <div>
              <h1 className="text-2xl font-bold text-gray-900 dark:text-white">Users</h1>
              <p className="text-gray-600 dark:text-gray-400 mt-1">Manage user accounts and rentals</p>
            </div>
            
            <button
              onClick={() => openModal('addUser')}
              className="mt-4 sm:mt-0 flex items-center justify-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors"
            >
              <i className="fas fa-user-plus mr-2"></i>
              Add User
            </button>
          </div>
          
          {/* Filters */}
          <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 mb-6 border border-gray-200 dark:border-gray-800">
            <div className="flex flex-col md:flex-row gap-4">
              <div className="flex-1">
                <label htmlFor="search" className="sr-only">Search</label>
                <div className="relative">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i className="fas fa-search text-gray-400"></i>
                  </div>
                  <input
                    id="search"
                    type="text"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    placeholder="Search users..."
                    className="block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md leading-5 bg-white dark:bg-dark-200 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-base"
                  />
                </div>
              </div>
              
              <div className="flex-none w-full md:w-48">
                <label htmlFor="status-filter" className="sr-only">Status Filter</label>
                <select
                  id="status-filter"
                  value={filterStatus}
                  onChange={(e) => setFilterStatus(e.target.value)}
                  className="block w-full pl-3 pr-10 py-2 border border-gray-300 dark:border-gray-700 rounded-md leading-5 bg-white dark:bg-dark-200 text-gray-900 dark:text-white focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-base"
                >
                  <option value="all">All Status</option>
                  <option value="verified">Verified</option>
                  <option value="pending">Pending</option>
                </select>
              </div>
            </div>
          </div>
          
          {/* Users Grid */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            {filteredUsers.length > 0 ? (
              filteredUsers.map(user => (
                <div 
                  key={user.id}
                  onClick={() => openModal('userDetails', user)}
                  className="bg-white dark:bg-dark-100 rounded-lg shadow-sm overflow-hidden border border-gray-200 dark:border-gray-800 hover:shadow-md transition-shadow cursor-pointer card"
                >
                  <div className="p-4">
                    <div className="flex items-center mb-4">
                      <img src={user.avatar} alt={user.name} className="h-14 w-14 rounded-full" />
                      <div className="ml-3 flex-grow">
                        <h3 className="font-semibold text-gray-900 dark:text-white">{user.name}</h3>
                        <p className="text-xs text-gray-600 dark:text-gray-400">{user.email}</p>
                      </div>
                      <div className="flex space-x-1">
                        <button 
                          onClick={(e) => {
                            e.stopPropagation();
                            openModal('editUser', user);
                          }}
                          className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
                        >
                          <i className="fas fa-edit"></i>
                        </button>
                        {user.rentals.length === 0 && (
                          <button 
                            onClick={(e) => handleDeleteUser(e, user.id)}
                            className="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-200"
                          >
                            <i className="fas fa-trash-alt"></i>
                          </button>
                        )}
                      </div>
                    </div>
                    
                    <div className="space-y-2 text-sm">
                      <div className="flex justify-between">
                        <span className="text-gray-600 dark:text-gray-400">ID:</span>
                        <span>{user.id}</span>
                      </div>
                      <div className="flex justify-between">
                        <span className="text-gray-600 dark:text-gray-400">Phone:</span>
                        <span>{user.phone}</span>
                      </div>
                      {user.studentId && (
                        <div className="flex justify-between">
                          <span className="text-gray-600 dark:text-gray-400">Student ID:</span>
                          <span>{user.studentId}</span>
                        </div>
                      )}
                      <div className="flex justify-between">
                        <span className="text-gray-600 dark:text-gray-400">Status:</span>
                        <span className={`${
                          user.status === 'verified' ? 'text-green-600 dark:text-green-400' : 'text-yellow-600 dark:text-yellow-400'
                        }`}>
                          {user.status === 'verified' ? 'Verified' : 'Pending'}
                        </span>
                      </div>
                    </div>
                    
                    <div className="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                      <div className="flex justify-between items-center">
                        <span className="text-gray-600 dark:text-gray-400">Active Rentals:</span>
                        <span className="bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 px-2 py-1 rounded-full text-xs font-medium">
                          {user.rentals.length}
                        </span>
                      </div>
                    </div>
                    
                    {user.status === 'verified' && (
                      <div className="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                        <button 
                          onClick={(e) => {
                            e.stopPropagation();
                            openModal('assignBicycle', { userId: user.id });
                          }}
                          className="w-full flex justify-center py-1.5 px-3 bg-primary-100 dark:bg-primary-900/50 text-primary-700 dark:text-primary-300 rounded hover:bg-primary-200 dark:hover:bg-primary-900 transition-colors text-sm"
                        >
                          <i className="fas fa-bicycle mr-2"></i> Assign Bicycle
                        </button>
                      </div>
                    )}
                    
                    {user.status === 'pending' && (
                      <div className="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                        <button 
                          onClick={(e) => {
                            e.stopPropagation();
                            openModal('verifyUser', user);
                          }}
                          className="w-full flex justify-center py-1.5 px-3 bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-900 transition-colors text-sm"
                        >
                          <i className="fas fa-check-circle mr-2"></i> Verify User
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              ))
            ) : (
              <div className="col-span-full flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400">
                <i className="fas fa-users text-4xl mb-4"></i>
                <p className="text-lg font-medium">No users found</p>
                <p className="text-sm mt-1">Try adjusting your search or filters</p>
              </div>
            )}
          </div>
        </div>
      );
    };
    
    // MaintenanceView Component
    const MaintenanceView = () => {
      const { maintenanceLogs, bicycles, openModal, completeMaintenance } = useContext(AppContext);
      const [activeTab, setActiveTab] = useState('pending');
      
      // Filter logs based on active tab
      const filteredLogs = maintenanceLogs.filter(log => {
        if (activeTab === 'pending') return log.status === 'pending';
        if (activeTab === 'completed') return log.status === 'completed';
        return true; // all logs
      });
      
      // Get bicycle name by ID
      const getBicycleName = (bicycleId) => {
        const bike = bicycles.find(b => b.id === bicycleId);
        return bike ? bike.name : 'Unknown';
      };
      
      return (
        <div className="p-4 md:p-6 animate-fade-in">
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
            <div>
              <h1 className="text-2xl font-bold text-gray-900 dark:text-white">Maintenance</h1>
              <p className="text-gray-600 dark:text-gray-400 mt-1">Track and manage bicycle maintenance</p>
            </div>
            
            <button
              onClick={() => openModal('reportMaintenance')}
              className="mt-4 sm:mt-0 flex items-center justify-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors"
            >
              <i className="fas fa-wrench mr-2"></i>
              Report Issue
            </button>
          </div>
          
          {/* Tabs */}
          <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm border border-gray-200 dark:border-gray-800 mb-6">
            <div className="flex border-b border-gray-200 dark:border-gray-800">
              <button
                onClick={() => setActiveTab('all')}
                className={`flex-1 py-3 text-sm font-medium text-center ${
                  activeTab === 'all'
                    ? 'text-primary-600 dark:text-primary-400 border-b-2 border-primary-600 dark:border-primary-400'
                    : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
                }`}
              >
                All
              </button>
              <button
                onClick={() => setActiveTab('pending')}
                className={`flex-1 py-3 text-sm font-medium text-center ${
                  activeTab === 'pending'
                    ? 'text-primary-600 dark:text-primary-400 border-b-2 border-primary-600 dark:border-primary-400'
                    : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
                }`}
              >
                Pending
              </button>
              <button
                onClick={() => setActiveTab('completed')}
                className={`flex-1 py-3 text-sm font-medium text-center ${
                  activeTab === 'completed'
                    ? 'text-primary-600 dark:text-primary-400 border-b-2 border-primary-600 dark:border-primary-400'
                    : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
                }`}
              >
                Completed
              </button>
            </div>
            
            {/* Maintenance Logs */}
            <div className="p-4">
              {filteredLogs.length > 0 ? (
                <div className="divide-y divide-gray-200 dark:divide-gray-800">
                  {filteredLogs.map(log => (
                    <div key={log.id} className="py-4 first:pt-0 last:pb-0">
                      <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                          <div className="flex items-center">
                            <span className={`inline-flex h-2 w-2 rounded-full mr-2 ${
                              log.status === 'pending' ? 'bg-yellow-500' : 'bg-green-500'
                            }`}></span>
                            <h3 className="text-lg font-medium text-gray-900 dark:text-white">{log.issue}</h3>
                          </div>
                          <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
                            {getBicycleName(log.bicycleId)} <span className="text-gray-500">({log.bicycleId})</span>
                          </p>
                        </div>
                        
                        <div className="mt-2 md:mt-0 flex items-center space-x-4">
                          <div className="text-right">
                            <p className="text-sm font-medium text-gray-900 dark:text-white">
                              ${log.cost || 0}
                            </p>
                            <p className="text-xs text-gray-500 dark:text-gray-400">
                              Reported: {log.reportDate}
                            </p>
                            {log.completedDate && (
                              <p className="text-xs text-gray-500 dark:text-gray-400">
                                Completed: {log.completedDate}
                              </p>
                            )}
                          </div>
                          
                          {log.status === 'pending' && (
                            <button
                              onClick={() => openModal('completeMaintenance', log)}
                              className="inline-flex items-center px-3 py-1 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:border-green-700 focus:shadow-outline-green active:bg-green-700 transition ease-in-out duration-150"
                            >
                              <i className="fas fa-check mr-1"></i>
                              Complete
                            </button>
                          )}
                        </div>
                      </div>
                      
                      <div className="mt-3">
                        <p className="text-sm text-gray-600 dark:text-gray-400">
                          {log.description}
                        </p>
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="flex flex-col items-center justify-center py-8 text-gray-500 dark:text-gray-400">
                  <i className="fas fa-clipboard-check text-4xl mb-4"></i>
                  <p className="text-lg font-medium">No maintenance logs found</p>
                  <p className="text-sm mt-1">
                    {activeTab === 'pending' 
                      ? 'All bicycles are in good condition'
                      : activeTab === 'completed'
                        ? 'No completed maintenance tasks yet'
                        : 'No maintenance history available'}
                  </p>
                </div>
              )}
            </div>
          </div>
          
          {/* Maintenance Statistics */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Maintenance Overview</h3>
              <div className="space-y-4">
                <div className="flex justify-between items-center">
                  <div>
                    <p className="text-sm text-gray-600 dark:text-gray-400">Total Logs</p>
                    <p className="text-xl font-semibold text-gray-900 dark:text-white">{maintenanceLogs.length}</p>
                  </div>
                  <div className="h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center">
                    <i className="fas fa-clipboard-list text-primary-600 dark:text-primary-400"></i>
                  </div>
                </div>
                
                <div className="flex justify-between items-center">
                  <div>
                    <p className="text-sm text-gray-600 dark:text-gray-400">Pending</p>
                    <p className="text-xl font-semibold text-yellow-600 dark:text-yellow-400">
                      {maintenanceLogs.filter(log => log.status === 'pending').length}
                    </p>
                  </div>
                  <div className="h-10 w-10 rounded-full bg-yellow-100 dark:bg-yellow-900 flex items-center justify-center">
                    <i className="fas fa-clock text-yellow-600 dark:text-yellow-400"></i>
                  </div>
                </div>
                
                <div className="flex justify-between items-center">
                  <div>
                    <p className="text-sm text-gray-600 dark:text-gray-400">Completed</p>
                    <p className="text-xl font-semibold text-green-600 dark:text-green-400">
                      {maintenanceLogs.filter(log => log.status === 'completed').length}
                    </p>
                  </div>
                  <div className="h-10 w-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center">
                    <i className="fas fa-check text-green-600 dark:text-green-400"></i>
                  </div>
                </div>
                
                <div className="pt-4 border-t border-gray-200 dark:border-gray-700">
                  <div className="flex justify-between items-center">
                    <div>
                      <p className="text-sm text-gray-600 dark:text-gray-400">Total Cost</p>
                      <p className="text-xl font-semibold text-gray-900 dark:text-white">
                        ${maintenanceLogs.reduce((sum, log) => sum + (log.cost || 0), 0)}
                      </p>
                    </div>
                    <div className="h-10 w-10 rounded-full bg-red-100 dark:bg-red-900 flex items-center justify-center">
                      <i className="fas fa-dollar-sign text-red-600 dark:text-red-400"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800 lg:col-span-2">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Common Issues</h3>
              <div className="space-y-3">
                <div className="flex items-center">
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-5">
                    <div className="bg-primary-600 h-5 rounded-full" style={{ width: '70%' }}></div>
                  </div>
                  <span className="ml-3 text-sm font-medium w-1/4">Flat tire (70%)</span>
                </div>
                <div className="flex items-center">
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-5">
                    <div className="bg-primary-600 h-5 rounded-full" style={{ width: '45%' }}></div>
                  </div>
                  <span className="ml-3 text-sm font-medium w-1/4">Brake adjustment (45%)</span>
                </div>
                <div className="flex items-center">
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-5">
                    <div className="bg-primary-600 h-5 rounded-full" style={{ width: '30%' }}></div>
                  </div>
                  <span className="ml-3 text-sm font-medium w-1/4">Chain issues (30%)</span>
                </div>
                <div className="flex items-center">
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-5">
                    <div className="bg-primary-600 h-5 rounded-full" style={{ width: '20%' }}></div>
                  </div>
                  <span className="ml-3 text-sm font-medium w-1/4">Gear problems (20%)</span>
                </div>
                <div className="flex items-center">
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-5">
                    <div className="bg-primary-600 h-5 rounded-full" style={{ width: '15%' }}></div>
                  </div>
                  <span className="ml-3 text-sm font-medium w-1/4">Damaged frame (15%)</span>
                </div>
              </div>
              
              <div className="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                <h4 className="text-md font-medium mb-3 text-gray-900 dark:text-white">Average Repair Time</h4>
                <div className="flex justify-between items-center">
                  <div className="flex items-center">
                    <div className="h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                      <i className="fas fa-tools text-blue-600 dark:text-blue-400"></i>
                    </div>
                    <div className="ml-3">
                      <p className="text-xl font-semibold text-gray-900 dark:text-white">1.2 days</p>
                      <p className="text-xs text-gray-600 dark:text-gray-400">From report to completion</p>
                    </div>
                  </div>
                  
                  <div className="flex items-center">
                    <div className="h-10 w-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center">
                      <i className="fas fa-bicycle text-green-600 dark:text-green-400"></i>
                    </div>
                    <div className="ml-3">
                      <p className="text-xl font-semibold text-gray-900 dark:text-white">97%</p>
                      <p className="text-xs text-gray-600 dark:text-gray-400">Maintenance success rate</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    // Finance Component
    const Finance = () => {
      const { payments, financialMetrics, openModal, markPaymentAsPaid, users, bicycles } = useContext(AppContext);
      const [activeTab, setActiveTab] = useState('all');
      
      // Filter payments based on active tab
      const filteredPayments = payments.filter(payment => {
        if (activeTab === 'pending') return payment.status === 'pending';
        if (activeTab === 'paid') return payment.status === 'paid';
        return true; // all payments
      });
      
      // Get user name from ID
      const getUserName = (userId) => {
        const user = users.find(u => u.id === userId);
        return user ? user.name : 'Unknown';
      };
      
      // Get bicycle name from ID
      const getBicycleName = (bicycleId) => {
        if (!bicycleId) return 'N/A';
        const bike = bicycles.find(b => b.id === bicycleId);
        return bike ? bike.name : 'Unknown';
      };
      
      return (
        <div className="p-4 md:p-6 animate-fade-in">
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
            <div>
              <h1 className="text-2xl font-bold text-gray-900 dark:text-white">Finance</h1>
              <p className="text-gray-600 dark:text-gray-400 mt-1">Manage payments and financial reports</p>
            </div>
            
            <button
              onClick={() => openModal('makePayment')}
              className="mt-4 sm:mt-0 flex items-center justify-center px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors"
            >
              <i className="fas fa-money-bill-wave mr-2"></i>
              Record Payment
            </button>
          </div>
          
          {/* Financial Summary */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-gray-500 dark:text-gray-400 text-sm">Total Revenue</p>
                  <h3 className="text-2xl font-bold mt-1 text-gray-900 dark:text-white">${financialMetrics.totalRevenue}</h3>
                </div>
                <div className="bg-green-100 dark:bg-green-900 p-2 rounded-md">
                  <i className="fas fa-dollar-sign text-green-600 dark:text-green-300 text-xl"></i>
                </div>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-gray-500 dark:text-gray-400 text-sm">Pending Revenue</p>
                  <h3 className="text-2xl font-bold mt-1 text-gray-900 dark:text-white">${financialMetrics.pendingRevenue}</h3>
                </div>
                <div className="bg-yellow-100 dark:bg-yellow-900 p-2 rounded-md">
                  <i className="fas fa-clock text-yellow-600 dark:text-yellow-300 text-xl"></i>
                </div>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-gray-500 dark:text-gray-400 text-sm">Maintenance Costs</p>
                  <h3 className="text-2xl font-bold mt-1 text-gray-900 dark:text-white">${financialMetrics.maintenanceCosts}</h3>
                </div>
                <div className="bg-red-100 dark:bg-red-900 p-2 rounded-md">
                  <i className="fas fa-wrench text-red-600 dark:text-red-300 text-xl"></i>
                </div>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-gray-500 dark:text-gray-400 text-sm">Net Revenue</p>
                  <h3 className="text-2xl font-bold mt-1 text-gray-900 dark:text-white">${financialMetrics.netRevenue}</h3>
                </div>
                <div className="bg-blue-100 dark:bg-blue-900 p-2 rounded-md">
                  <i className="fas fa-chart-line text-blue-600 dark:text-blue-300 text-xl"></i>
                </div>
              </div>
            </div>
          </div>
          
          {/* Tabs */}
          <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm border border-gray-200 dark:border-gray-800 mb-6">
            <div className="flex border-b border-gray-200 dark:border-gray-800">
              <button
                onClick={() => setActiveTab('all')}
                className={`flex-1 py-3 text-sm font-medium text-center ${
                  activeTab === 'all'
                    ? 'text-primary-600 dark:text-primary-400 border-b-2 border-primary-600 dark:border-primary-400'
                    : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
                }`}
              >
                All Transactions
              </button>
              <button
                onClick={() => setActiveTab('pending')}
                className={`flex-1 py-3 text-sm font-medium text-center ${
                  activeTab === 'pending'
                    ? 'text-primary-600 dark:text-primary-400 border-b-2 border-primary-600 dark:border-primary-400'
                    : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
                }`}
              >
                Pending
              </button>
              <button
                onClick={() => setActiveTab('paid')}
                className={`flex-1 py-3 text-sm font-medium text-center ${
                  activeTab === 'paid'
                    ? 'text-primary-600 dark:text-primary-400 border-b-2 border-primary-600 dark:border-primary-400'
                    : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
                }`}
              >
                Paid
              </button>
            </div>
            
            {/* Payments Table */}
            <div className="overflow-x-auto">
              <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-800">
                <thead className="bg-gray-50 dark:bg-dark-200">
                  <tr>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      ID
                    </th>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      User
                    </th>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      Type
                    </th>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      Bicycle
                    </th>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      Amount
                    </th>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      Date
                    </th>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      Status
                    </th>
                    <th scope="col" className="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody className="bg-white dark:bg-dark-100 divide-y divide-gray-200 dark:divide-gray-800">
                  {filteredPayments.length > 0 ? (
                    filteredPayments.map(payment => (
                      <tr key={payment.id}>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                          {payment.id}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
                          {getUserName(payment.userId)}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                          <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                            payment.type === 'rental' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' :
                            payment.type === 'membership' ? 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200' :
                            'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200'
                          }`}>
                            {payment.type.charAt(0).toUpperCase() + payment.type.slice(1)}
                          </span>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                          {getBicycleName(payment.bicycleId)}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
                          ${payment.amount}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                          {payment.date}
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm">
                          <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                            payment.status === 'paid' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :
                            'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'
                          }`}>
                            {payment.status.charAt(0).toUpperCase() + payment.status.slice(1)}
                          </span>
                        </td>
                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                          {payment.status === 'pending' ? (
                            <button
                              onClick={() => markPaymentAsPaid(payment.id)}
                              className="text-primary-600 hover:text-primary-900 dark:text-primary-400 dark:hover:text-primary-300 mr-3"
                            >
                              <i className="fas fa-check mr-1"></i> Mark as Paid
                            </button>
                          ) : (
                            <button disabled className="text-gray-500 cursor-not-allowed">
                              <i className="fas fa-check-circle mr-1"></i> Paid
                            </button>
                          )}
                        </td>
                      </tr>
                    ))
                  ) : (
                    <tr>
                      <td colSpan="8" className="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                        No transactions found
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>
          </div>
          
          {/* Payment Methods */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Payment Methods</h3>
              <div className="space-y-4">
                <div className="flex items-center p-3 rounded-lg bg-gray-50 dark:bg-dark-200">
                  <div className="h-10 w-10 flex items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900">
                    <i className="fab fa-paypal text-blue-600 dark:text-blue-400"></i>
                  </div>
                  <div className="ml-3">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">PayID</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">Connected</p>
                  </div>
                  <div className="ml-auto">
                    <span className="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                      Primary
                    </span>
                  </div>
                </div>
                
                <div className="flex items-center p-3 rounded-lg bg-gray-50 dark:bg-dark-200">
                  <div className="h-10 w-10 flex items-center justify-center rounded-full bg-green-100 dark:bg-green-900">
                    <i className="fab fa-stripe-s text-green-600 dark:text-green-400"></i>
                  </div>
                  <div className="ml-3">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">Stripe</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">Connected</p>
                  </div>
                </div>
                
                <div className="flex items-center p-3 rounded-lg bg-gray-50 dark:bg-dark-200">
                  <div className="h-10 w-10 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-800">
                    <i className="fas fa-university text-gray-600 dark:text-gray-400"></i>
                  </div>
                  <div className="ml-3">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">Bank Transfer</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">Available</p>
                  </div>
                </div>
                
                <button className="mt-2 w-full flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-dark-200 hover:bg-gray-50 dark:hover:bg-dark-300 focus:outline-none">
                  <i className="fas fa-plus mr-2"></i> Add Payment Method
                </button>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800 lg:col-span-2">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Revenue Breakdown</h3>
              
              <div className="space-y-4">
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Rental Income</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">75%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-primary-600 h-2.5 rounded-full" style={{ width: '75%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Membership Fees</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">20%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-primary-600 h-2.5 rounded-full" style={{ width: '20%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Deposits</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">5%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-primary-600 h-2.5 rounded-full" style={{ width: '5%' }}></div>
                  </div>
                </div>
              </div>
              
              <div className="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                <h4 className="text-md font-medium mb-3 text-gray-900 dark:text-white">Payment Status</h4>
                
                <div className="flex items-center space-x-8">
                  <div className="flex items-center">
                    <div className="h-10 w-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center">
                      <i className="fas fa-check text-green-600 dark:text-green-400"></i>
                    </div>
                    <div className="ml-3">
                      <p className="text-xl font-semibold text-gray-900 dark:text-white">
                        {payments.filter(p => p.status === 'paid').length}
                      </p>
                      <p className="text-xs text-gray-600 dark:text-gray-400">Paid</p>
                    </div>
                  </div>
                  
                  <div className="flex items-center">
                    <div className="h-10 w-10 rounded-full bg-yellow-100 dark:bg-yellow-900 flex items-center justify-center">
                      <i className="fas fa-clock text-yellow-600 dark:text-yellow-400"></i>
                    </div>
                    <div className="ml-3">
                      <p className="text-xl font-semibold text-gray-900 dark:text-white">
                        {payments.filter(p => p.status === 'pending').length}
                      </p>
                      <p className="text-xs text-gray-600 dark:text-gray-400">Pending</p>
                    </div>
                  </div>
                  
                  <div className="flex items-center">
                    <div className="h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
                      <i className="fas fa-percentage text-blue-600 dark:text-blue-400"></i>
                    </div>
                    <div className="ml-3">
                      <p className="text-xl font-semibold text-gray-900 dark:text-white">
                        {Math.round((payments.filter(p => p.status === 'paid').length / payments.length) * 100) || 0}%
                      </p>
                      <p className="text-xs text-gray-600 dark:text-gray-400">Collection Rate</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          {/* WhatsApp Integration */}
          <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
            <div className="flex flex-col md:flex-row md:items-center md:justify-between">
              <div className="flex items-center">
                <div className="h-10 w-10 rounded-full bg-green-500 flex items-center justify-center">
                  <i className="fab fa-whatsapp text-white text-xl"></i>
                </div>
                <div className="ml-4">
                  <h3 className="text-lg font-semibold text-gray-900 dark:text-white">WhatsApp Payment Reminders</h3>
                  <p className="text-sm text-gray-600 dark:text-gray-400">Send automated payment reminders to users via WhatsApp</p>
                </div>
              </div>
              
              <div className="mt-4 md:mt-0 flex items-center space-x-4">
                <button className="flex items-center justify-center px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors">
                  <i className="fas fa-bell mr-2"></i>
                  Send Reminders
                </button>
                
                <button className="flex items-center justify-center px-4 py-2 border border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-50 dark:hover:bg-dark-300 transition-colors">
                  <i className="fas fa-cog mr-2"></i>
                  Configure
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    // Reports Component
// Reports Component
const Reports = () => {
  const { 
    bicycles, 
    users, 
    payments, 
    maintenanceLogs, 
    recentActivity,
    bicycleStatusCounts,
    financialMetrics
  } = useContext(AppContext);
  
  const [selectedReport, setSelectedReport] = useState('overview');
  const [dateRange, setDateRange] = useState('month');
  
  // Refs for charts
  const revenueChartRef = useRef(null);
  const bicycleUsageChartRef = useRef(null);
  const maintenanceChartRef = useRef(null);
  const userActivityChartRef = useRef(null);
  
  // Chart instances
  const chartInstances = useRef({
    revenue: null,
    bicycleUsage: null,
    maintenance: null,
    userActivity: null
  });
  
  // Calculate data for reports
  const calculateReportData = () => {
    // Mock data generators based on real app data
    const getRevenueData = () => {
      let labels = [];
      let data = [];
      
      if (dateRange === 'week') {
        labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
        data = [
          financialMetrics.totalRevenue * 0.12,
          financialMetrics.totalRevenue * 0.15,
          financialMetrics.totalRevenue * 0.18,
          financialMetrics.totalRevenue * 0.14,
          financialMetrics.totalRevenue * 0.16,
          financialMetrics.totalRevenue * 0.13,
          financialMetrics.totalRevenue * 0.12
        ];
      } else if (dateRange === 'month') {
        labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
        data = [
          financialMetrics.totalRevenue * 0.2,
          financialMetrics.totalRevenue * 0.3,
          financialMetrics.totalRevenue * 0.28,
          financialMetrics.totalRevenue * 0.22
        ];
      } else if (dateRange === 'quarter') {
        labels = ['Month 1', 'Month 2', 'Month 3'];
        data = [
          financialMetrics.totalRevenue * 0.3,
          financialMetrics.totalRevenue * 0.35,
          financialMetrics.totalRevenue * 0.35
        ];
      } else {
        labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        data = Array(12).fill(0).map(() => financialMetrics.totalRevenue / 12 * (0.8 + Math.random() * 0.4));
      }
      
      return { labels, data };
    };
    
    const getBicycleUsageData = () => {
      // Group bicycles by type
      const typeCount = bicycles.reduce((counts, bike) => {
        counts[bike.type] = (counts[bike.type] || 0) + 1;
        return counts;
      }, {});
      
      // Calculate usage percentage by type (using rentals as proxy)
      const rentedBikes = bicycles.filter(bike => bike.status === 'rented');
      const rentedTypeCount = rentedBikes.reduce((counts, bike) => {
        counts[bike.type] = (counts[bike.type] || 0) + 1;
        return counts;
      }, {});
      
      const labels = Object.keys(typeCount);
      const data = labels.map(type => (rentedTypeCount[type] || 0) / typeCount[type] * 100 || 0);
      
      return { labels, data };
    };
    
    const getMaintenanceData = () => {
      // Group maintenance by type
      const issueTypes = {};
      maintenanceLogs.forEach(log => {
        const issueType = log.issue.includes('tire') ? 'Tire Issues' :
                         log.issue.includes('brake') ? 'Brake Issues' :
                         log.issue.includes('chain') ? 'Chain Issues' :
                         log.issue.includes('gear') ? 'Gear Issues' :
                         log.issue.includes('battery') ? 'Battery Issues' :
                         'Other';
        
        issueTypes[issueType] = (issueTypes[issueType] || 0) + 1;
      });
      
      const labels = Object.keys(issueTypes);
      const data = labels.map(type => issueTypes[type]);
      
      return { labels, data };
    };
    
    const getUserActivityData = () => {
      // User signup over time (mock based on user IDs)
      let labels = [];
      let data = [];
      
      if (dateRange === 'week') {
        labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
        data = Array(7).fill(0).map(() => Math.floor(users.length / 7 * (0.7 + Math.random() * 0.6)));
      } else if (dateRange === 'month') {
        labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
        data = [
          Math.floor(users.length * 0.2),
          Math.floor(users.length * 0.3),
          Math.floor(users.length * 0.28),
          Math.floor(users.length * 0.22)
        ];
      } else {
        labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        data = Array(12).fill(0).map(() => Math.floor(users.length / 12 * (0.8 + Math.random() * 0.4)));
      }
      
      return { labels, data };
    };
    
    return {
      revenue: getRevenueData(),
      bicycleUsage: getBicycleUsageData(),
      maintenance: getMaintenanceData(),
      userActivity: getUserActivityData()
    };
  };
  
  // Create or update charts when report type or data changes
  useEffect(() => {
    const reportData = calculateReportData();
    const isDarkMode = document.documentElement.classList.contains('dark');
    const gridColor = isDarkMode ? '#374151' : '#e5e7eb';
    const textColor = isDarkMode ? '#9ca3af' : '#4b5563';
    
    if (selectedReport === 'financial' && revenueChartRef.current) {
      if (chartInstances.current.revenue) {
        chartInstances.current.revenue.destroy();
      }
      
      const { labels, data } = reportData.revenue;
      
      chartInstances.current.revenue = new Chart(revenueChartRef.current, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'Revenue',
            data,
            borderColor: '#8b5cf6',
            backgroundColor: 'rgba(139, 92, 246, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              grid: {
                display: false,
                color: gridColor
              },
              ticks: {
                color: textColor
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: gridColor
              },
              ticks: {
                color: textColor,
                callback: function(value) {
                  return '$' + value;
                }
              }
            }
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return '$' + context.raw.toFixed(2);
                }
              }
            }
          }
        }
      });
    }
    
    if (selectedReport === 'usage' && bicycleUsageChartRef.current) {
      if (chartInstances.current.bicycleUsage) {
        chartInstances.current.bicycleUsage.destroy();
      }
      
      const { labels, data } = reportData.bicycleUsage;
      
      chartInstances.current.bicycleUsage = new Chart(bicycleUsageChartRef.current, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Usage Rate %',
            data,
            backgroundColor: [
              'rgba(59, 130, 246, 0.6)', // blue
              'rgba(16, 185, 129, 0.6)', // green
              'rgba(249, 115, 22, 0.6)', // orange
              'rgba(139, 92, 246, 0.6)', // purple
              'rgba(239, 68, 68, 0.6)'   // red
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              grid: {
                display: false,
                color: gridColor
              },
              ticks: {
                color: textColor
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: gridColor
              },
              ticks: {
                color: textColor,
                callback: function(value) {
                  return value + '%';
                }
              },
              max: 100
            }
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.raw.toFixed(1) + '% utilization';
                }
              }
            }
          }
        }
      });
    }
    
    if (selectedReport === 'maintenance' && maintenanceChartRef.current) {
      if (chartInstances.current.maintenance) {
        chartInstances.current.maintenance.destroy();
      }
      
      const { labels, data } = reportData.maintenance;
      
      chartInstances.current.maintenance = new Chart(maintenanceChartRef.current, {
        type: 'doughnut',
        data: {
          labels,
          datasets: [{
            data,
            backgroundColor: [
              'rgba(239, 68, 68, 0.6)',   // red
              'rgba(249, 115, 22, 0.6)',  // orange
              'rgba(16, 185, 129, 0.6)',  // green
              'rgba(59, 130, 246, 0.6)',  // blue
              'rgba(139, 92, 246, 0.6)',  // purple
              'rgba(107, 114, 128, 0.6)'  // gray
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                padding: 20,
                boxWidth: 12,
                color: textColor
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round(context.raw / total * 100);
                  return `${context.label}: ${context.raw} issues (${percentage}%)`;
                }
              }
            }
          },
          cutout: '60%'
        }
      });
    }
    
    if (selectedReport === 'user' && userActivityChartRef.current) {
      if (chartInstances.current.userActivity) {
        chartInstances.current.userActivity.destroy();
      }
      
      const { labels, data } = reportData.userActivity;
      
      chartInstances.current.userActivity = new Chart(userActivityChartRef.current, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'New Users',
            data,
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              grid: {
                display: false,
                color: gridColor
              },
              ticks: {
                color: textColor
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: gridColor
              },
              ticks: {
                color: textColor,
                precision: 0
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
    }
    
    // Cleanup function
    return () => {
      Object.values(chartInstances.current).forEach(chart => {
        if (chart) {
          chart.destroy();
        }
      });
    };
  }, [selectedReport, dateRange, bicycles, users, payments, maintenanceLogs, financialMetrics]);
  
  // Calculate summary metrics
  const calculateMetrics = () => {
    switch (selectedReport) {
      case 'overview':
        return {
          revenueGrowth: '+24%',
          userGrowth: `+${Math.floor(users.length * 0.18)}%`,
          fleetGrowth: `+${Math.floor(bicycles.length * 0.12)}%`,
          capacityUtilization: `${Math.floor(bicycleStatusCounts.rented / bicycles.length * 100)}%`,
          customerSatisfaction: '92%',
          operationalEfficiency: '78%'
        };
      case 'financial':
        return {
          totalRevenue: financialMetrics.totalRevenue,
          rentalRevenue: financialMetrics.totalRevenue * 0.75,
          membershipRevenue: financialMetrics.totalRevenue * 0.2,
          otherRevenue: financialMetrics.totalRevenue * 0.05,
          maintenanceCost: financialMetrics.maintenanceCosts,
          operationsCost: financialMetrics.maintenanceCosts * 0.8,
          marketingCost: financialMetrics.maintenanceCosts * 0.4
        };
      case 'usage':
        const rentedBikes = bicycles.filter(bike => bike.status === 'rented').length;
        return {
          mostPopular: 'Mountain Explorer',
          mostPopularRentals: Math.floor(bicycles.length * 0.15),
          mostPopularSatisfaction: '92%',
          averageRentalDuration: '3.5 days',
          utilizationRate: `${Math.floor(rentedBikes / bicycles.length * 100)}%`
        };
      case 'maintenance':
        return {
          totalIssues: maintenanceLogs.length,
          avgRepairTime: '1.2 days',
          avgRepairCost: Math.floor(financialMetrics.maintenanceCosts / maintenanceLogs.length),
          commonIssue: 'Flat tire',
          issueFrequency: `${Math.floor(maintenanceLogs.length / bicycles.length * 10) / 10}/bike`
        };
      case 'user':
        return {
          totalUsers: users.length,
          newUsers: Math.floor(users.length * 0.2),
          activeUsers: users.filter(user => user.rentals && user.rentals.length > 0).length,
          averageRentalsPerUser: (bicycleStatusCounts.rented / users.length).toFixed(1),
          averageSpend: Math.floor(financialMetrics.totalRevenue / users.length)
        };
      default:
        return {};
    }
  };
  
  const metrics = calculateMetrics();
  
  return (
    <div className="p-4 md:p-6 animate-fade-in">
      <div className="mb-6">
        <h1 className="text-2xl font-bold text-gray-900 dark:text-white">Reports</h1>
        <p className="text-gray-600 dark:text-gray-400 mt-1">View and analyze business performance</p>
      </div>
      
      {/* Report Options */}
      <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 mb-6 border border-gray-200 dark:border-gray-800">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label htmlFor="report-type" className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
              Report Type
            </label>
            <select
              id="report-type"
              value={selectedReport}
              onChange={(e) => setSelectedReport(e.target.value)}
              className="block w-full pl-3 pr-10 py-2 border border-gray-300 dark:border-gray-700 rounded-md leading-5 bg-white dark:bg-dark-200 text-gray-900 dark:text-white focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-base"
            >
              <option value="overview">Business Overview</option>
              <option value="financial">Financial Report</option>
              <option value="usage">Bicycle Usage</option>
              <option value="maintenance">Maintenance Report</option>
              <option value="user">User Activity</option>
            </select>
          </div>
          
          <div>
            <label htmlFor="date-range" className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
              Time Period
            </label>
            <select
              id="date-range"
              value={dateRange}
              onChange={(e) => setDateRange(e.target.value)}
              className="block w-full pl-3 pr-10 py-2 border border-gray-300 dark:border-gray-700 rounded-md leading-5 bg-white dark:bg-dark-200 text-gray-900 dark:text-white focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-base"
            >
              <option value="week">Last 7 Days</option>
              <option value="month">Last 30 Days</option>
              <option value="quarter">Last 3 Months</option>
              <option value="year">Last 12 Months</option>
            </select>
          </div>
        </div>
      </div>
      
      {/* Selected Report */}
      <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 mb-6 border border-gray-200 dark:border-gray-800">
        <div className="flex items-center justify-between mb-4">
          <h2 className="text-xl font-semibold text-gray-900 dark:text-white">
            {selectedReport === 'overview' && 'Business Overview'}
            {selectedReport === 'financial' && 'Financial Report'}
            {selectedReport === 'usage' && 'Bicycle Usage'}
            {selectedReport === 'maintenance' && 'Maintenance Report'}
            {selectedReport === 'user' && 'User Activity'}
          </h2>
          
          <div className="flex space-x-2">
            <button className="flex items-center justify-center px-3 py-1 text-sm bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 rounded hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors">
              <i className="fas fa-download mr-1"></i> Export
            </button>
            <button className="flex items-center justify-center px-3 py-1 text-sm bg-gray-100 dark:bg-dark-300 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-dark-400 transition-colors">
              <i className="fas fa-print mr-1"></i> Print
            </button>
          </div>
        </div>
        
        {/* Report Content with actual charts */}
        <div className="p-4 bg-gray-50 dark:bg-dark-200 rounded-lg">
          {selectedReport === 'overview' && (
            <div className="text-center">
              <div className="grid grid-cols-3 gap-2 mb-4">
                <div className="bg-white dark:bg-dark-100 p-3 rounded-lg shadow-sm">
                  <p className="text-sm text-gray-500 dark:text-gray-400">Total Bicycles</p>
                  <p className="text-2xl font-bold text-gray-900 dark:text-white">{bicycles.length}</p>
                </div>
                <div className="bg-white dark:bg-dark-100 p-3 rounded-lg shadow-sm">
                  <p className="text-sm text-gray-500 dark:text-gray-400">Total Users</p>
                  <p className="text-2xl font-bold text-gray-900 dark:text-white">{users.length}</p>
                </div>
                <div className="bg-white dark:bg-dark-100 p-3 rounded-lg shadow-sm">
                  <p className="text-sm text-gray-500 dark:text-gray-400">Net Revenue</p>
                  <p className="text-2xl font-bold text-gray-900 dark:text-white">${financialMetrics.netRevenue}</p>
                </div>
              </div>
              
              <div className="flex justify-center my-6">
                <div className="inline-flex h-24 w-full max-w-md">
                  <div className="flex-1 bg-primary-100 dark:bg-primary-900 rounded-l-lg flex flex-col items-center justify-center border-r border-white dark:border-dark-200">
                    <p className="text-xl font-bold text-primary-700 dark:text-primary-300">{bicycleStatusCounts.available || 0}</p>
                    <p className="text-xs text-primary-600 dark:text-primary-400">Available</p>
                  </div>
                  <div className="flex-1 bg-blue-100 dark:bg-blue-900 flex flex-col items-center justify-center border-r border-white dark:border-dark-200">
                    <p className="text-xl font-bold text-blue-700 dark:text-blue-300">{bicycleStatusCounts.rented || 0}</p>
                    <p className="text-xs text-blue-600 dark:text-blue-400">Rented</p>
                  </div>
                  <div className="flex-1 bg-red-100 dark:bg-red-900 rounded-r-lg flex flex-col items-center justify-center">
                    <p className="text-xl font-bold text-red-700 dark:text-red-300">{bicycleStatusCounts.maintenance || 0}</p>
                    <p className="text-xs text-red-600 dark:text-red-400">Maintenance</p>
                  </div>
                </div>
              </div>
              
              <p className="text-gray-600 dark:text-gray-400 mb-4">
                Business Overview for {dateRange === 'week' ? 'the last 7 days' : 
                                      dateRange === 'month' ? 'the last 30 days' : 
                                      dateRange === 'quarter' ? 'the last 3 months' : 
                                      'the last 12 months'}
              </p>
            </div>
          )}
          
          {selectedReport === 'financial' && (
            <div className="h-80">
              <canvas ref={revenueChartRef}></canvas>
            </div>
          )}
          
          {selectedReport === 'usage' && (
            <div className="h-80">
              <canvas ref={bicycleUsageChartRef}></canvas>
            </div>
          )}
          
          {selectedReport === 'maintenance' && (
            <div className="h-80">
              <canvas ref={maintenanceChartRef}></canvas>
            </div>
          )}
          
          {selectedReport === 'user' && (
            <div className="h-80">
              <canvas ref={userActivityChartRef}></canvas>
            </div>
          )}
        </div>
      </div>
      
      {/* Report Metrics */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* Business Overview Metrics */}
        {selectedReport === 'overview' && (
          <>
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Business Growth</h3>
              <div className="flex space-x-3">
                <div className="flex-1 p-3 bg-gray-50 dark:bg-dark-200 rounded-lg text-center">
                  <p className="text-xs text-gray-500 dark:text-gray-400">Revenue Growth</p>
                  <p className="text-xl font-bold text-primary-600 dark:text-primary-400">{metrics.revenueGrowth}</p>
                </div>
                <div className="flex-1 p-3 bg-gray-50 dark:bg-dark-200 rounded-lg text-center">
                  <p className="text-xs text-gray-500 dark:text-gray-400">User Growth</p>
                  <p className="text-xl font-bold text-primary-600 dark:text-primary-400">{metrics.userGrowth}</p>
                </div>
                <div className="flex-1 p-3 bg-gray-50 dark:bg-dark-200 rounded-lg text-center">
                  <p className="text-xs text-gray-500 dark:text-gray-400">Fleet Growth</p>
                  <p className="text-xl font-bold text-primary-600 dark:text-primary-400">{metrics.fleetGrowth}</p>
                </div>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Key Performance Indicators</h3>
              <div className="space-y-4">
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Capacity Utilization</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">{metrics.capacityUtilization}</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-green-600 h-2.5 rounded-full" style={{ width: metrics.capacityUtilization }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Customer Satisfaction</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">{metrics.customerSatisfaction}</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-primary-600 h-2.5 rounded-full" style={{ width: metrics.customerSatisfaction }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Operational Efficiency</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">{metrics.operationalEfficiency}</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-blue-600 h-2.5 rounded-full" style={{ width: metrics.operationalEfficiency }}></div>
                  </div>
                </div>
              </div>
            </div>
          </>
        )}
        
        {/* Financial Report Metrics */}
        {selectedReport === 'financial' && (
          <>
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Revenue Sources</h3>
              <div className="flex space-x-3">
                <div className="flex-1 p-3 bg-gray-50 dark:bg-dark-200 rounded-lg text-center">
                  <p className="text-xs text-gray-500 dark:text-gray-400">Rentals</p>
                  <p className="text-xl font-bold text-primary-600 dark:text-primary-400">${metrics.rentalRevenue.toFixed(2)}</p>
                </div>
                <div className="flex-1 p-3 bg-gray-50 dark:bg-dark-200 rounded-lg text-center">
                  <p className="text-xs text-gray-500 dark:text-gray-400">Memberships</p>
                  <p className="text-xl font-bold text-primary-600 dark:text-primary-400">${metrics.membershipRevenue.toFixed(2)}</p>
                </div>
                <div className="flex-1 p-3 bg-gray-50 dark:bg-dark-200 rounded-lg text-center">
                  <p className="text-xs text-gray-500 dark:text-gray-400">Other</p>
                  <p className="text-xl font-bold text-primary-600 dark:text-primary-400">${metrics.otherRevenue.toFixed(2)}</p>
                </div>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Expense Breakdown</h3>
              <div className="space-y-4">
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Maintenance</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">${metrics.maintenanceCost}</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-red-600 h-2.5 rounded-full" style={{ width: '45%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Operations</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">${metrics.operationsCost.toFixed(2)}</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-red-600 h-2.5 rounded-full" style={{ width: '35%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Marketing</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">${metrics.marketingCost.toFixed(2)}</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-red-600 h-2.5 rounded-full" style={{ width: '20%' }}></div>
                  </div>
                </div>
              </div>
            </div>
          </>
        )}
        
        {/* Bicycle Usage Metrics */}
        {selectedReport === 'usage' && (
          <>
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Most Popular Bicycles</h3>
              <div className="space-y-3">
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-primary-100 dark:bg-primary-900 rounded-md">
                    <i className="fas fa-bicycle text-primary-600 dark:text-primary-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">{metrics.mostPopular}</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">{metrics.mostPopularRentals} rentals</p>
                  </div>
                  <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                    {metrics.mostPopularSatisfaction} Satisfaction
                  </span>
                </div>
                
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-primary-100 dark:bg-primary-900 rounded-md">
                    <i className="fas fa-bicycle text-primary-600 dark:text-primary-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">City Cruiser</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">{Math.floor(metrics.mostPopularRentals * 0.85)} rentals</p>
                  </div>
                  <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                    88% Satisfaction
                  </span>
                </div>
                
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-primary-100 dark:bg-primary-900 rounded-md">
                    <i className="fas fa-bicycle text-primary-600 dark:text-primary-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">Eco Rider</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">{Math.floor(metrics.mostPopularRentals * 0.7)} rentals</p>
                  </div>
                  <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                    94% Satisfaction
                  </span>
                </div>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Usage Metrics</h3>
              <div className="grid grid-cols-2 gap-4 mb-6">
                <div className="p-3 bg-gray-50 dark:bg-dark-200 rounded-lg text-center">
                  <p className="text-xs text-gray-500 dark:text-gray-400">Average Rental Duration</p>
                  <p className="text-xl font-bold text-blue-600 dark:text-blue-400">{metrics.averageRentalDuration}</p>
                </div>
                <div className="p-3 bg-gray-50 dark:bg-dark-200 rounded-lg text-center">
                  <p className="text-xs text-gray-500 dark:text-gray-400">Utilization Rate</p>
                  <p className="text-xl font-bold text-blue-600 dark:text-blue-400">{metrics.utilizationRate}</p>
                </div>
              </div>
              
              <h4 className="text-md font-medium mb-2 text-gray-900 dark:text-white">Rental Duration</h4>
              <div className="space-y-3">
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">1-3 Days</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">45%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-blue-600 h-2.5 rounded-full" style={{ width: '45%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">4-7 Days</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">30%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-blue-600 h-2.5 rounded-full" style={{ width: '30%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">1-2 Weeks</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">15%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-blue-600 h-2.5 rounded-full" style={{ width: '15%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">2+ Weeks</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">10%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-blue-600 h-2.5 rounded-full" style={{ width: '10%' }}></div>
                  </div>
                </div>
              </div>
            </div>
          </>
        )}
        
        {/* Maintenance Report Metrics */}
        {selectedReport === 'maintenance' && (
          <>
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Maintenance Frequency</h3>
              <div className="space-y-3">
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-red-100 dark:bg-red-900 rounded-md">
                    <i className="fas fa-wrench text-red-600 dark:text-red-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">Flat Tires</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">{Math.floor(metrics.totalIssues * 0.4)} reported issues</p>
                  </div>
                  <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                    ${Math.floor(metrics.totalIssues * 0.4 * metrics.avgRepairCost)} total cost
                  </span>
                </div>
                
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-red-100 dark:bg-red-900 rounded-md">
                    <i className="fas fa-wrench text-red-600 dark:text-red-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">Brake Issues</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">{Math.floor(metrics.totalIssues * 0.25)} reported issues</p>
                  </div>
                  <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                    ${Math.floor(metrics.totalIssues * 0.25 * metrics.avgRepairCost)} total cost
                  </span>
                </div>
                
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-red-100 dark:bg-red-900 rounded-md">
                    <i className="fas fa-wrench text-red-600 dark:text-red-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">Chain Problems</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">{Math.floor(metrics.totalIssues * 0.15)} reported issues</p>
                  </div>
                  <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">
                    ${Math.floor(metrics.totalIssues * 0.15 * metrics.avgRepairCost)} total cost
                  </span>
                </div>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Maintenance Metrics</h3>
              <div className="grid grid-cols-2 gap-4">
                <div className="p-3 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="text-center">
                    <p className="text-xs text-gray-500 dark:text-gray-400">Avg. Repair Time</p>
                    <p className="text-xl font-bold text-red-600 dark:text-red-400">{metrics.avgRepairTime}</p>
                  </div>
                </div>
                
                <div className="p-3 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="text-center">
                    <p className="text-xs text-gray-500 dark:text-gray-400">Avg. Cost per Repair</p>
                    <p className="text-xl font-bold text-red-600 dark:text-red-400">${metrics.avgRepairCost}</p>
                  </div>
                </div>
                
                <div className="p-3 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="text-center">
                    <p className="text-xs text-gray-500 dark:text-gray-400">Maintenance Frequency</p>
                    <p className="text-xl font-bold text-red-600 dark:text-red-400">{metrics.issueFrequency}</p>
                  </div>
                </div>
                
                <div className="p-3 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="text-center">
                    <p className="text-xs text-gray-500 dark:text-gray-400">Total Cost</p>
                    <p className="text-xl font-bold text-red-600 dark:text-red-400">${financialMetrics.maintenanceCosts}</p>
                  </div>
                </div>
              </div>
            </div>
          </>
        )}
        
        {/* User Activity Metrics */}
        {selectedReport === 'user' && (
          <>
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">User Demographics</h3>
              <div className="space-y-4">
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Students</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">60%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-yellow-500 h-2.5 rounded-full" style={{ width: '60%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Professionals</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">25%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-yellow-500 h-2.5 rounded-full" style={{ width: '25%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Tourists</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">10%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-yellow-500 h-2.5 rounded-full" style={{ width: '10%' }}></div>
                  </div>
                </div>
                
                <div>
                  <div className="flex justify-between items-center mb-1">
                    <p className="text-sm font-medium text-gray-700 dark:text-gray-300">Others</p>
                    <p className="text-sm font-medium text-gray-900 dark:text-white">5%</p>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-dark-300 rounded-full h-2.5">
                    <div className="bg-yellow-500 h-2.5 rounded-full" style={{ width: '5%' }}></div>
                  </div>
                </div>
              </div>
            </div>
            
            <div className="bg-white dark:bg-dark-100 rounded-lg shadow-sm p-4 border border-gray-200 dark:border-gray-800">
              <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">User Activity</h3>
              <div className="space-y-3">
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-blue-100 dark:bg-blue-900 rounded-md">
                    <i className="fas fa-user text-blue-600 dark:text-blue-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">Total Users</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">{metrics.totalUsers} users</p>
                  </div>
                </div>
                
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-blue-100 dark:bg-blue-900 rounded-md">
                    <i className="fas fa-users text-blue-600 dark:text-blue-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">New Users ({dateRange === 'week' ? 'This Week' : dateRange === 'month' ? 'This Month' : dateRange === 'quarter' ? 'This Quarter' : 'This Year'})</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">{metrics.newUsers} users</p>
                  </div>
                </div>
                
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-blue-100 dark:bg-blue-900 rounded-md">
                    <i className="fas fa-bicycle text-blue-600 dark:text-blue-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">Active Users</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">{metrics.activeUsers} users currently have rentals</p>
                  </div>
                </div>
                
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-blue-100 dark:bg-blue-900 rounded-md">
                    <i className="fas fa-chart-line text-blue-600 dark:text-blue-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">Average Rentals</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">{metrics.averageRentalsPerUser} rentals per user</p>
                  </div>
                </div>
                
                <div className="flex items-center p-2 bg-gray-50 dark:bg-dark-200 rounded-lg">
                  <div className="h-10 w-10 flex items-center justify-center bg-blue-100 dark:bg-blue-900 rounded-md">
                    <i className="fas fa-money-bill-wave text-blue-600 dark:text-blue-400"></i>
                  </div>
                  <div className="ml-3 flex-1">
                    <p className="text-sm font-medium text-gray-900 dark:text-white">Average Spend</p>
                    <p className="text-xs text-gray-500 dark:text-gray-400">${metrics.averageSpend} per user</p>
                  </div>
                </div>
              </div>
            </div>
          </>
        )}
      </div>
    </div>
  );
};
    
    // Main App Component
    const App = () => {
      const { activePage } = useContext(AppContext);
      
      return (
        <div className="min-h-screen bg-gray-100 dark:bg-dark-300 flex flex-col">
          <Navigation />
          
          <div className="md:ml-64 flex-1 transition-all duration-300">
            <div className="md:hidden h-16"></div>
            {activePage === 'dashboard' && <Dashboard />}
            {activePage === 'bicycles' && <Bicycles />}
            {activePage === 'users' && <Users />}
            {activePage === 'maintenance' && <MaintenanceView />}
            {activePage === 'finance' && <Finance />}
            {activePage === 'reports' && <Reports />}
          </div>
          
          <Modal />
          <Notifications />
        </div>
      );
    };
    
    // Render the App with Context Provider
    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(
      <AppProvider>
        <App />
      </AppProvider>
    );
  </script>
</body>
</html>
